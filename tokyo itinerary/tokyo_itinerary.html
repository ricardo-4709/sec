<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±äº¬ 5 æ—¥å®¢è£½åŒ–è¡Œç¨‹è¦åŠƒ</title>
    
    <!-- PWA ç›¸é—œè¨­å®š -->
    <meta name="theme-color" content="#FDFCF5">
    <link rel="manifest" href="./manifest.json">
    
    <!-- iOS å°ˆç”¨è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ±äº¬ä¹‹æ—…">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/201/201623.png">

    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'jp-gold': '#D4AF37',
                        'jp-gold-light': '#F3E5AB',
                        'jp-brown': '#594a4e',
                        'jp-red': '#C0392B',
                        'jp-cream': '#FDFCF5',
                    },
                    fontFamily: {
                        sans: ['Zen Old Mincho', 'Noto Serif TC', 'serif'],
                        serif: ['Zen Old Mincho', 'Noto Serif TC', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        body {
            background-color: #FDFCF5;
            background-image: radial-gradient(#D4AF37 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            color: #594a4e;
            overflow-x: hidden;
            min-height: 100vh;
            overscroll-behavior-y: none;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-btn {
            position: relative; padding: 0.35rem 1rem; margin-right: 0.25rem; font-size: 0.85rem; font-weight: 600; color: #594a4e;
            border: 1px solid #D4AF37; border-radius: 9999px; transition: all 0.3s ease; background-color: white; white-space: nowrap; flex-shrink: 0;
        }
        .nav-btn:hover, .nav-btn.active {
            background-color: #D4AF37; color: white; box-shadow: 0 2px 4px -1px rgba(212, 175, 55, 0.3); transform: translateY(-1px);
        }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .date-tab {
            display: block; width: 100%; text-align: center; padding: 0.75rem 0.25rem; border-right: 3px solid transparent; border-left: 0; border-bottom: 1px solid #e5e7eb;
            color: #594a4e; transition: all 0.3s; font-family: 'Zen Old Mincho', serif;
        }
        @media (min-width: 768px) { .date-tab { text-align: left; padding: 1rem 1.5rem; border-right: 0; border-left: 4px solid transparent; border-bottom: 0; } }
        .date-tab:hover { background-color: rgba(212, 175, 55, 0.1); }
        .date-tab.active { background-color: white; font-weight: bold; }
        @media (max-width: 767px) { .date-tab.active { border-right-color: #D4AF37; background-color: #fff; } }
        @media (min-width: 768px) { .date-tab.active { border-left-color: #D4AF37; box-shadow: 0 2px 10px rgba(0,0,0,0.05); } }
        .date-tab .day-num { font-size: 1rem; display: block; font-weight: bold; }
        .date-tab .day-week { font-size: 0.7rem; opacity: 0.8; display: block; margin-top: 2px; }
        @media (min-width: 768px) { .date-tab .day-num { font-size: 1.25rem; } .date-tab .day-week { font-size: 0.875rem; } }
        .timeline-container { position: relative; padding-left: 1rem; }
        @media (min-width: 768px) { .timeline-container { padding-left: 2rem; } }
        .detail-item { position: relative; padding-bottom: 1.5rem; border-left: 1px solid #D4AF37; padding-left: 1.25rem; }
        .detail-item:last-child { border-left: transparent; }
        .detail-item::before {
            content: ''; position: absolute; left: -5px; top: 0; width: 11px; height: 11px;
            background-color: #FDFCF5; border: 2px solid #D4AF37; border-radius: 50%;
        }
        .detail-time { font-family: 'Noto Serif TC', serif; color: #D4AF37; font-weight: bold; margin-bottom: 0.1rem; font-size: 0.85rem; }
        .detail-title { font-size: 1rem; font-weight: bold; color: #594a4e; margin-bottom: 0.25rem; }
        .detail-desc {
            font-size: 0.85rem; color: #666; line-height: 1.5; background-color: rgba(243, 229, 171, 0.15); padding: 0.5rem; border-radius: 0.5rem;
        }
        .recommend-tag {
            display: inline-block; margin-top: 0.25rem; background-color: #FCE7F3; color: #9D174D; font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; border: 1px solid #FBCFE8;
        }
        .dining-list { margin-top: 0.5rem; background-color: #fff; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.4rem; }
        .dining-header { font-size: 0.7rem; font-weight: bold; color: #D4AF37; margin-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6; padding-bottom: 0.2rem; }
        .dining-item { display: flex; justify-content: space-between; align-items: flex-start; padding: 0.25rem 0; border-bottom: 1px dashed #f3f4f6; }
        .dining-item:last-child { border-bottom: none; }
        .dining-name-link { font-weight: bold; color: #594a4e; font-size: 0.8rem; display: flex; align-items: center; text-decoration: none; transition: color 0.2s; }
        .dining-name-link:hover { color: #D4AF37; text-decoration: underline; }
        .dining-note { font-size: 0.7rem; color: #666; display: block; margin-top: 1px; }
        .dining-rating { font-size: 0.7rem; color: #d97706; background-color: #fef3c7; padding: 1px 4px; border-radius: 3px; white-space: nowrap; margin-left: 0.5rem; flex-shrink: 0; }
        .in-map-badge { font-size: 0.6rem; background-color: #dbeafe; color: #1e40af; padding: 0 3px; border-radius: 2px; margin-left: 3px; white-space: nowrap; }
        .shop-category { font-weight: bold; color: #D4AF37; font-size: 1rem; margin-top: 1rem; margin-bottom: 0.5rem; border-bottom: 2px solid #F3E5AB; padding-bottom: 0.25rem; }
        .shop-item { display: flex; align-items: flex-start; padding: 0.6rem; background: white; border: 1px solid #f3f4f6; border-radius: 0.5rem; margin-bottom: 0.5rem; transition: all 0.2s; }
        .shop-item:hover { box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-color: #D4AF37; }
        .shop-item.checked { opacity: 0.6; background-color: #f9fafb; }
        .shop-item.checked .shop-name { text-decoration: line-through; color: #9ca3af; }
        .shop-tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: auto; white-space: nowrap; font-weight: bold; }
        .tag-drugstore { background-color: #fee2e2; color: #b91c1c; }
        .tag-variety { background-color: #fef3c7; color: #d97706; }
        .tag-fashion { background-color: #e0e7ff; color: #4338ca; }
        .tag-contact { background-color: #fce7f3; color: #be185d; }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(89, 74, 78, 0.6); backdrop-filter: blur(2px); }
        .modal-content { background-color: #FDFCF5; margin: 10% auto; padding: 1.5rem; border: 1px solid #D4AF37; width: 90%; max-width: 500px; border-radius: 1rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .filter-btn.active { background-color: #594a4e; color: #FDFCF5; border-color: #594a4e; }
        .spot-item { transition: all 0.2s ease-in-out; cursor: pointer; border-left: 4px solid transparent; }
        .spot-item:hover { background-color: rgba(243, 229, 171, 0.3); }
        .spot-item.active-spot { background-color: rgba(212, 175, 55, 0.15); border-left-color: #D4AF37; }
        .loading-text { color: #D4AF37; font-size: 0.8rem; text-align: center; padding: 1rem; animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .dist-badge { font-size: 0.65rem; background-color: #e5e7eb; color: #374151; padding: 2px 5px; border-radius: 999px; font-weight: bold; margin-left: auto; }
        .dist-near { background-color: #dcfce7; color: #166534; }
    </style>
</head>
<body class="font-serif">
    <nav class="sticky top-0 z-50 bg-jp-cream/95 backdrop-blur-md shadow-sm border-b border-jp-gold/20 pt-safe-top">
        <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8">
            <div class="flex flex-col items-center justify-center py-2">
                <div class="mb-2">
                    <h1 class="text-xl sm:text-2xl font-bold text-jp-brown tracking-widest border-b-2 border-jp-gold pb-1 px-4">TOKYO TRIP</h1>
                </div>
                <div id="navbar-scroll-container" class="flex flex-nowrap justify-start sm:justify-center gap-1 w-full overflow-x-auto no-scrollbar px-1 pb-1 scroll-smooth">
                    <button class="nav-btn active" data-section="checklist">è¡Œå‰æº–å‚™</button>
                    <button class="nav-btn" data-section="transport">äº¤é€šä½å®¿</button>
                    <button class="nav-btn" data-section="daily-itinerary">æ¯æ—¥è¡Œç¨‹</button>
                    <button class="nav-btn" data-section="map-list">æ—…ç¨‹åœ°åœ–</button>
                    <button class="nav-btn" data-section="shopping-list">è³¼ç‰©æ¸…å–®</button>
                </div>
            </div>
        </div>
    </nav>
    <main id="main-content" class="max-w-6xl mx-auto py-1 px-2 sm:px-6 lg:px-8 pb-4">
        <section id="checklist" class="content-section active bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 md:mb-8 flex items-center justify-center"><span class="text-jp-gold mr-3">âœ¦</span> è¡Œå‰æº–å‚™ <span class="text-jp-gold ml-3">âœ¦</span></h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8">
                <div class="bg-jp-gold-light/10 p-4 rounded-lg border border-jp-gold/20">
                    <h3 class="text-base font-bold text-jp-red mb-3 flex items-center">âš ï¸ å‹™å¿…é å…ˆé ç´„ / æ¶ç¥¨</h3>
                    <ul class="space-y-2 text-sm text-jp-brown list-disc list-inside">
                        <li><strong>SHIBUYA SKYï¼š</strong> 12/7 æ—¥è½å ´æ¬¡ (å·²è³¼è²· âœ…)ã€‚</li>
                        <li><strong>è»æ¸¯å·¡èˆªï¼š</strong> 12/6 12:00 èˆ¹ç­ã€‚</li>
                        <li><strong>æ°´ä¸Šå·´å£«ï¼š</strong> 12/8 æ·ºè‰ â†’ æµœé›¢å®®ã€‚</li>
                        <li><strong>ç“”ç (åˆé¤)ï¼š</strong> 12/5 12:15 (å·²è¨‚ä½)ã€‚</li>
                        <li><strong>äº¤é€šåˆ¸ï¼š</strong> N'EXã€å°ç”°æ€¥ã€Subway Ticketã€‚</li>
                    </ul>
                </div>
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2"><h3 class="text-base font-bold text-jp-brown">è¡Œææ¸…å–®</h3><span class="text-[0.6rem] text-jp-gold border border-jp-gold px-1 rounded">æœ¬æ©Ÿå„²å­˜ (é›¢ç·šå¯ç”¨)</span></div>
                        <div class="text-xs text-gray-500">å¯é»æ“Šç·¨è¼¯</div>
                    </div>
                    <div class="mb-4 bg-gray-50 p-2 rounded border border-gray-100 flex flex-col gap-2">
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input id="new-item-input" type="text" placeholder="ç‰©å“åç¨±" class="w-full sm:flex-grow p-2 border rounded text-sm focus:outline-none focus:border-jp-gold">
                            <select id="new-item-category" class="w-full sm:w-auto p-2 border rounded text-sm bg-white"><option value="é›œç‰©">é›œç‰©</option><option value="3C">3C</option><option value="è¡£ç‰©">è¡£ç‰©</option><option value="åŒ–å¦ã€ä¿é¤Š">ä¿é¤Š</option><option value="é‡è¦">é‡è¦</option></select>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <select id="new-item-location" class="w-full sm:w-1/3 p-2 border rounded text-sm bg-white"><option value="å¤§ç®±">å¤§ç®±</option><option value="ç™»æ©Ÿç®±">ç™»æ©Ÿç®±</option><option value="éš¨èº«åŒ…">éš¨èº«</option></select>
                            <input id="new-item-note" type="text" placeholder="å‚™è¨» (é¸å¡«)" class="w-full sm:flex-grow p-2 border rounded text-sm">
                            <button id="add-item-btn" onclick="addItem()" class="w-full sm:w-auto bg-jp-gold text-white hover:bg-yellow-600 px-4 py-2 sm:py-1 rounded text-sm transition font-bold">æ–°å¢</button>
                        </div>
                    </div>
                    <div id="luggage-list-container" class="space-y-1 max-h-[60vh] sm:max-h-[400px] overflow-y-auto pr-1"></div>
                </div>
            </div>
        </section>
        <section id="transport" class="content-section bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 md:mb-8 flex items-center justify-center"><span class="text-jp-gold mr-3">âœ¦</span> äº¤é€šèˆ‡ä½å®¿ <span class="text-jp-gold ml-3">âœ¦</span></h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8">
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-jp-brown border-l-4 border-jp-gold pl-2">ä½å®¿åœ°é»</h3>
                    <div class="bg-jp-gold-light/20 p-4 rounded-lg border border-jp-gold/30 hover:shadow-md transition">
                        <h4 class="font-bold text-base mb-1 text-jp-brown">ç®±æ ¹ï¼šHakone Pax Yoshino</h4>
                        <div class="text-sm space-y-1 opacity-90"><p>ğŸ“… å…¥ä½ï¼š12/5 (é€±äº”)</p><p>ğŸ’° è²»ç”¨ï¼šNT$5,933</p><p class="text-jp-gold font-medium mt-1">â™¨ï¸ å«æº«æ³‰è¨­æ–½ï¼Œè¿‘ç®±æ ¹æ¹¯æœ¬ç«™ã€‚</p></div>
                        <div class="mt-3 flex gap-2">
                            <a href="https://www.google.com/maps/search/?api=1&query=Hakone+Pax+Yoshino" target="_blank" class="flex-1 bg-white border border-jp-gold text-jp-gold text-center py-1.5 rounded text-sm font-bold hover:bg-jp-gold hover:text-white transition">ğŸ“ å°èˆª</a>
                            <a href="https://drive.google.com/file/d/1kFCqkIJQaeTwhye7JWpecG2g66Il7S7n/view?usp=drive_link" target="_blank" class="flex-1 bg-jp-gold text-white text-center py-1.5 rounded text-sm font-bold hover:bg-yellow-600 transition">ğŸ“„ å…¥ä½æ†‘è­‰</a>
                        </div>
                    </div>
                    <div class="bg-jp-gold-light/20 p-4 rounded-lg border border-jp-red/30 hover:shadow-md transition relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-jp-red text-white text-xs px-2 py-1 rounded-bl">é‡è¦</div>
                        <h4 class="font-bold text-base mb-1 text-jp-brown">æ±äº¬ï¼šç§‹è‘‰è‹‘</h4>
                        <div class="text-sm space-y-1 opacity-90"><p>ğŸ“… å…¥ä½ï¼š12/6 - 12/8 (ä¸‰æ™š)</p><p>ğŸ“ åœ°å€ï¼šåƒä»£ç”°åŒºå¤–ç¥ç”°ä¸‰ä¸ç›®8-8</p><p>ğŸ“ é›»è©±ï¼š070-8333-3174</p></div>
                        <div class="mt-3 grid grid-cols-2 gap-2">
                            <a href="https://www.google.com/maps/search/?api=1&query=åƒä»£ç”°åŒºå¤–ç¥ç”°ä¸‰ä¸ç›®8-8" target="_blank" class="bg-white border border-gray-400 text-gray-700 text-center py-1.5 rounded text-sm font-bold hover:bg-gray-100 transition">ğŸ“ å°èˆª</a>
                            <a href="https://fl-hotel.jp/wp-content/uploads/RAK-Self-Check-in-Instruction.pdf" target="_blank" class="bg-blue-600 text-white text-center py-1.5 rounded text-sm font-bold hover:bg-blue-700 transition">ğŸ“˜ å…¥ä½æŒ‡å—</a>
                            <button onclick="openAccommodationModal()" class="col-span-2 border border-jp-red text-jp-red hover:bg-jp-red hover:text-white font-bold py-1.5 rounded transition duration-300 text-sm flex items-center justify-center"><span class="mr-2">âš ï¸</span> æŸ¥çœ‹è©³ç´°å…¥ä½é ˆçŸ¥</button>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-jp-brown border-l-4 border-jp-gold pl-2">èˆªç­è³‡è¨Š</h3>
                    <div onclick="openFlightModal()" class="cursor-pointer group bg-white p-4 rounded-lg border border-jp-gold/30 shadow-sm hover:shadow-md hover:border-jp-gold transition-all duration-300 relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-jp-gold text-white text-xs px-2 py-1 rounded-bl-lg font-bold">é»æ“ŠæŸ¥çœ‹è©³æƒ…</div>
                        <div class="flex flex-col gap-3">
                            <div class="flex items-center gap-3"><div class="bg-jp-gold/10 p-2 rounded-full text-xl">âœˆï¸</div><div><h4 class="text-base font-bold text-jp-brown">å°åŒ— â‡Œ æ±äº¬</h4><p class="text-xs text-gray-500">2025/12/5 - 12/9</p></div></div>
                            <div class="flex gap-2 text-xs text-gray-600"><span class="bg-gray-100 px-2 py-1 rounded flex items-center gap-1"><span class="text-jp-red font-bold">å»</span> GK012</span><span class="bg-gray-100 px-2 py-1 rounded flex items-center gap-1"><span class="text-jp-brown font-bold">å›</span> TR875</span></div>
                        </div>
                    </div>
                    <h3 class="text-lg font-bold text-jp-brown border-l-4 border-jp-gold pl-2">äº¤é€šç¥¨åˆ¸</h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-sm leading-relaxed">
                        <ul class="space-y-3 list-none ml-0 text-jp-brown text-sm">
                            <li class="pl-2 border-l-2 border-jp-gold"><span class="font-bold block">N'EX æˆç”°ç‰¹å¿«</span><span class="text-xs text-gray-600">Klookè¨‚ç¥¨é¸ä½ â†’ QR Code åˆ°æ©Ÿå ´è»Šç«™å…§çš„<span class="text-blue-600 font-bold">æ·ºè—è‰²æŒ‡å®šå¸­å”®ç¥¨æ©Ÿ</span>æ›ç¥¨ã€‚</span></li>
                            <li class="pl-2 border-l-2 border-jp-gold"><span class="font-bold block">ç®±æ ¹å‘¨éŠåˆ¸ + æµªæ¼«ç‰¹å¿«</span><span class="text-xs text-gray-600">å‡ºç¤º EMOT è»Šç¥¨åŠè³¼è²·æ†‘è­‰ã€‚</span></li>
                            <li class="pl-2 border-l-2 border-jp-gold"><span class="font-bold block">Subway Ticket (3æ—¥)</span><span class="text-xs text-gray-600">Klookè³¼è²· â†’ ç¬¬äºŒå¤©è‡³ç§‹è‘‰åŸæ™‚å°‹æ‰¾<span class="text-red-500 font-bold">ç´…è‰²åœ“æ¨™ç¤ºç¥¨æ©Ÿ</span>æ›ç¥¨ (12/7~12/9 ä½¿ç”¨)ã€‚</span></li>
                            <li class="pl-2 border-l-2 border-jp-gold"><span class="font-bold block">è¥¿ç“œå¡ (Suica)</span><span class="text-xs text-gray-600">æ©Ÿå ´è³¼è²·ï¼Œå„²å€¼ ï¿¥3000 (è¼”åŠ©ç”¨)ã€‚</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <section id="daily-itinerary" class="content-section bg-white rounded-2xl shadow-lg border border-jp-gold/20 overflow-hidden">
            <div class="flex flex-row h-[calc(100dvh-140px)] md:h-[650px]">
                <div class="w-14 md:w-1/4 bg-gray-50 border-r border-gray-200 flex flex-col overflow-y-auto no-scrollbar flex-shrink-0 z-10">
                    <button class="date-tab active" onclick="renderItinerary('day1', this)"><span class="day-num">12/5</span><span class="day-week">é€±äº”</span></button>
                    <button class="date-tab" onclick="renderItinerary('day2', this)"><span class="day-num">12/6</span><span class="day-week">é€±å…­</span></button>
                    <button class="date-tab" onclick="renderItinerary('day3', this)"><span class="day-num">12/7</span><span class="day-week">é€±æ—¥</span></button>
                    <button class="date-tab" onclick="renderItinerary('day4', this)"><span class="day-num">12/8</span><span class="day-week">é€±ä¸€</span></button>
                    <button class="date-tab" onclick="renderItinerary('day5', this)"><span class="day-num">12/9</span><span class="day-week">é€±äºŒ</span></button>
                </div>
                <div class="flex-1 bg-white overflow-y-auto h-full p-3 md:p-8 relative scroll-smooth"><div id="itinerary-content"></div></div>
            </div>
        </section>
        <section id="map-list" class="content-section bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 flex items-center justify-center"><span class="text-jp-gold mr-3">âœ¦</span> æ—…ç¨‹åœ°åœ– <span class="text-jp-gold ml-3">âœ¦</span></h2>
            <div class="flex flex-wrap justify-center gap-2 mb-4 items-center">
                <button class="filter-btn active px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="food">ç¾é£Ÿ</button>
                <button class="filter-btn px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="shopping">è³¼ç‰©</button>
                <button class="filter-btn px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="sightseeing">æ™¯é»</button>
                <div class="flex gap-1">
                    <button class="filter-btn px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium whitespace-nowrap" data-filter="nearest">ğŸ“ æœ€è¿‘</button>
                    <button id="refresh-loc-btn" onclick="refreshLocation()" class="hidden px-2 py-1 rounded bg-gray-200 text-gray-700 text-sm hover:bg-gray-300 transition" title="åˆ·æ–°å®šä½">â†»</button>
                </div>
            </div>
            <div class="flex flex-col md:flex-row gap-4 h-[calc(100dvh-190px)] md:h-[600px]">
                <div class="w-full md:w-3/5 h-2/5 md:h-full rounded-xl overflow-hidden shadow-md border border-gray-300 relative bg-gray-100 shrink-0">
                    <iframe id="map-frame" class="w-full h-full border-0" loading="lazy" allowfullscreen src=""></iframe>
                    <div id="map-placeholder" class="absolute inset-0 flex items-center justify-center bg-gray-100 text-gray-500 text-sm p-4 text-center">è«‹é»æ“Šåœ°é»ä»¥é¡¯ç¤ºåœ°åœ–</div>
                </div>
                <div class="w-full md:w-2/5 h-3/5 md:h-full overflow-y-auto pr-1 space-y-2" id="spots-list-container"></div>
            </div>
        </section>
        <section id="shopping-list" class="content-section bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 flex items-center justify-center"><span class="text-jp-gold mr-3">âœ¦</span> è²·è²·è²·æ¸…å–® <span class="text-jp-gold ml-3">âœ¦</span></h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="shopping-list-container"></div>
        </section>
    </main>
    <div id="edit-modal" class="modal"><div class="modal-content"><h3 class="text-lg font-bold mb-4 text-jp-brown">ç·¨è¼¯ç‰©å“</h3><div class="space-y-3"><input id="edit-item-name" class="w-full p-2 border rounded text-sm" placeholder="åç¨±"><div class="flex gap-2"><select id="edit-item-category" class="w-1/2 p-2 border rounded text-sm bg-white"></select><select id="edit-item-location" class="w-1/2 p-2 border rounded text-sm bg-white"></select></div><input id="edit-item-note" class="w-full p-2 border rounded text-sm" placeholder="å‚™è¨»"><div class="flex justify-end gap-2 mt-4"><button onclick="closeModal()" class="px-3 py-1.5 text-sm bg-gray-200 rounded">å–æ¶ˆ</button><button onclick="saveEdit()" class="px-3 py-1.5 text-sm bg-jp-gold text-white rounded">å„²å­˜</button></div></div></div></div>
    <div id="delete-modal" class="modal"><div class="modal-content !max-w-sm text-center"><h3 class="text-lg font-bold mb-4 text-jp-brown">ç¢ºå®šåˆªé™¤æ­¤ç‰©å“ï¼Ÿ</h3><div class="flex justify-center gap-4"><button onclick="closeDeleteModal()" class="px-3 py-1.5 text-sm bg-gray-200 rounded hover:bg-gray-300">å–æ¶ˆ</button><button onclick="confirmDelete()" class="px-3 py-1.5 text-sm bg-jp-red text-white rounded hover:bg-red-700">ç¢ºå®šåˆªé™¤</button></div></div></div>
    <div id="flight-modal" class="modal"><div class="modal-content !max-w-2xl"><div class="flex justify-between items-center mb-4 border-b border-jp-gold/20 pb-2"><div><h3 class="text-lg font-bold text-jp-brown">èˆªç­è©³ç´°è³‡è¨Š</h3></div><button onclick="closeFlightModal()" class="text-gray-400 hover:text-gray-600 text-xl">Ã—</button></div><div class="space-y-4 overflow-y-auto max-h-[60vh] pr-2"><div class="bg-gray-50 rounded-lg p-3 border border-gray-200"><div class="flex justify-between items-center mb-2"><span class="bg-jp-red text-white text-xs px-2 py-1 rounded font-bold">å»ç¨‹</span><span class="text-sm font-bold text-jp-brown">GK012</span></div><div class="flex justify-between items-center mb-2 text-center"><div><div class="text-xl font-bold text-jp-brown font-serif">02:30</div><div class="text-xs text-gray-500">TPE T1</div></div><div class="text-gray-300 text-xs">â”€â”€âœˆâ”€â”€</div><div><div class="text-xl font-bold text-jp-brown font-serif">06:35</div><div class="text-xs text-gray-500">NRT T3</div></div></div></div><div class="bg-gray-50 rounded-lg p-3 border border-gray-200"><div class="flex justify-between items-center mb-2"><span class="bg-jp-brown text-white text-xs px-2 py-1 rounded font-bold">å›ç¨‹</span><span class="text-sm font-bold text-jp-brown">TR875</span></div><div class="flex justify-between items-center mb-2 text-center"><div><div class="text-xl font-bold text-jp-brown font-serif">19:55</div><div class="text-xs text-gray-500">NRT T1</div></div><div class="text-gray-300 text-xs">â”€â”€âœˆâ”€â”€</div><div><div class="text-xl font-bold text-jp-brown font-serif">23:10</div><div class="text-xs text-gray-500">TPE T1</div></div></div></div></div><div class="mt-4 flex flex-col gap-2"><a href="https://drive.google.com/file/d/1ceKVL8iBFr5vEEehSfgJVRKazmoc6PPP/view?usp=sharing" target="_blank" class="block w-full bg-blue-600 text-white text-center py-2 rounded hover:bg-blue-700 transition font-bold">ğŸ“„ æŸ¥çœ‹é›»å­è¡Œç¨‹å–®</a><button onclick="closeFlightModal()" class="w-full mt-2 bg-jp-brown text-white py-2 rounded hover:bg-gray-700 transition">é—œé–‰</button></div></div></div>
    <div id="accommodation-modal" class="modal"><div class="modal-content border-t-4 border-jp-red"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-jp-brown">ç§‹è‘‰è‹‘ - å…¥ä½é ˆçŸ¥</h3><button onclick="closeAccommodationModal()" class="text-gray-400 hover:text-gray-600">âœ•</button></div><div class="bg-red-50 p-3 rounded border border-red-100 mb-3 space-y-2"><p class="font-bold text-jp-red text-base">âš ï¸ åš´é‡è­¦å‘Š & è¦å®š</p><ul class="list-decimal list-inside text-xs text-red-800 space-y-1 font-bold"><li>å±‹å…§åš´ç¦å¸è¸ã€‚</li><li>åƒä»£ç”°å€åƒåœ¾è¦å®šæ¥µåš´æ ¼ï¼Œè«‹å‹™å¿…éµç…§æŒ‡å—ä¸Ÿæ£„ï¼Œé•è€…è‡ªè² æ³•å¾‹è²¬ä»»ã€‚</li><li>è«‹åœ¨åˆ°é”å‰ 1 å°æ™‚é€šçŸ¥ã€‚</li><li>è‹¥éœ€æ™šä¸Š 7 é»å¾Œå…¥ä½ï¼Œè«‹æå‰é ç´„ã€‚</li></ul></div><div class="space-y-3 text-sm text-gray-700 border-t pt-3 border-gray-100"><div><p class="font-bold text-jp-brown">ğŸ•’ å…¥ä½æ™‚é–“</p><p>16:00 ä»¥å¾Œ (å…¥ä½å¾Œè«‹å‚³è¨Šæ¯å‘ŠçŸ¥)</p></div><div><p class="font-bold text-jp-brown">ğŸ§³ è¡Œæå¯„å­˜</p><p>å…¥ä½æ—¥ 10:00 å¾Œå¯æ”¾å…¥æˆ¿å…§ã€‚</p><p class="text-xs text-gray-500">*è«‹å‚³æ”¾å¥½å¾Œçš„ç…§ç‰‡ï¼Œä¸¦æ³¨æ„å‹¿å¸¶èµ°é‘°åŒ™ã€‚</p></div><div><p class="font-bold text-jp-brown">ğŸ”‘ é€€æˆ¿æ™‚é–“</p><p>10:00 ä»¥å‰ (é‘°åŒ™æ”¾å›é‘°åŒ™ç›’)</p><p class="text-xs text-red-500 font-bold mt-1">*ç„¡å»¶é²é€€æˆ¿æœå‹™ï¼Œé•è€…æ¯å°æ™‚ç½°æ¬¾ 5000 æ—¥åœ“ã€‚</p></div></div><button onclick="closeAccommodationModal()" class="w-full mt-4 bg-jp-brown text-white py-2 rounded hover:bg-gray-700 transition">æˆ‘å·²äº†è§£</button></div></div>

    <script>
        const defaultLuggageItems = [{id:1,category:"3C",location:"å¤§ç®±",item:"å……é›»é ­+ç·š*2",note:"",checked:false},{id:2,category:"åŒ–å¦ã€ä¿é¤Š",location:"å¤§ç®±",item:"åŒ–å¦åŒ…",note:"",checked:false},{id:3,category:"åŒ–å¦ã€ä¿é¤Š",location:"å¤§ç®±",item:"ä¿é¤Šå“",note:"é›…æ¼¾ã€æ´—é¢ä¹³ã€ä¹³æ¶²ã€å¸å¦ã€éš±çœ¼",checked:false},{id:4,category:"åŒ–å¦ã€ä¿é¤Š",location:"å¤§ç®±",item:"é›»æ£’",note:"",checked:false},{id:5,category:"è¡£ç‰©",location:"å¤§ç®±",item:"é´å­",note:"",checked:false},{id:6,category:"è¡£ç‰©",location:"å¤§ç®±",item:"å¸½å­",note:"",checked:false},{id:7,category:"è¡£ç‰©",location:"å¤§ç®±",item:"å›ºå®šé«®å¤¾",note:"",checked:false},{id:8,category:"è¡£ç‰©",location:"å¤§ç®±",item:"è¤²è¥ª",note:"",checked:false},{id:9,category:"è¡£ç‰©",location:"å¤§ç®±",item:"ç¡è¡£",note:"",checked:false},{id:10,category:"é›œç‰©",location:"å¤§ç®±",item:"è­·æ‰‹éœœ",note:"",checked:false},{id:11,category:"åŒ–å¦ã€ä¿é¤Š",location:"ç™»æ©Ÿç®±",item:"é¡å­",note:"",checked:false},{id:12,category:"åŒ–å¦ã€ä¿é¤Š",location:"ç™»æ©Ÿç®±",item:"é¦™æ°´",note:"",checked:false},{id:13,category:"åŒ–å¦ã€ä¿é¤Š",location:"ç™»æ©Ÿç®±",item:"å°åŒ–å¦åŒ…",note:"è£œå¦ç”¨",checked:false},{id:14,category:"è¡£ç‰©",location:"ç™»æ©Ÿç®±",item:"åšå¤–å¥—",note:"",checked:false},{id:15,category:"é›œç‰©",location:"ç™»æ©Ÿç®±",item:"è—¥å“",note:"",checked:false},{id:16,category:"é›œç‰©",location:"ç™»æ©Ÿç®±",item:"ç‰™åˆ·",note:"",checked:false},{id:17,category:"é›œç‰©",location:"ç™»æ©Ÿç®±",item:"æš–æš–åŒ…",note:"",checked:false},{id:18,category:"é›œç‰©",location:"ç™»æ©Ÿç®±",item:"è¡Œæç§¤",note:"",checked:false},{id:19,category:"3C",location:"éš¨èº«åŒ…",item:"è€³æ©Ÿ",note:"",checked:false},{id:20,category:"3C",location:"éš¨èº«åŒ…",item:"è¡Œå‹•é›»æº",note:"",checked:false},{id:21,category:"3C",location:"éš¨èº«åŒ…",item:"ç¶²å¡",note:"",checked:false},{id:22,category:"3C",location:"éš¨èº«åŒ…",item:"è‡ªæ‹æ£’",note:"",checked:false},{id:23,category:"åŒ–å¦ã€ä¿é¤Š",location:"éš¨èº«åŒ…",item:"è­·å”‡è†",note:"",checked:false},{id:24,category:"åŒ–å¦ã€ä¿é¤Š",location:"éš¨èº«åŒ…",item:"æ¢³å­",note:"",checked:false},{id:25,category:"é‡è¦",location:"éš¨èº«åŒ…",item:"è­·ç…§",note:"",checked:false},{id:26,category:"é‡è¦",location:"éš¨èº«åŒ…",item:"æ—¥å¹£",note:"",checked:false},{id:27,category:"é‡è¦",location:"éš¨èº«åŒ…",item:"ææ¬¾å¡",note:"",checked:false},{id:28,category:"é›œç‰©",location:"éš¨èº«åŒ…",item:"è¡›ç”Ÿç´™",note:"",checked:false},{id:29,category:"é›œç‰©",location:"éš¨èº«åŒ…",item:"æ¿•ç´™å·¾",note:"",checked:false},{id:30,category:"é›œç‰©",location:"å¤§ç®±",item:"æŒ‡ç”²å‰ª",note:"",checked:false}];
        const STORAGE_KEY = 'tokyo_trip_luggage_v1';
        let luggageItems = []; let currentEditId = null; let itemToDeleteId = null;
        const navBtns = document.querySelectorAll('.nav-btn'); const sections = document.querySelectorAll('.content-section'); const spotsListContainer = document.getElementById('spots-list-container'); const mapFrame = document.getElementById('map-frame'); const mapPlaceholder = document.getElementById('map-placeholder'); const filterBtns = document.querySelectorAll('.filter-btn'); const shoppingContainer = document.getElementById('shopping-list-container'); const luggageContainer = document.getElementById('luggage-list-container'); const mainContent = document.getElementById('main-content');

        function initApp() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) { try { luggageItems = JSON.parse(saved); } catch(e) { luggageItems = [...defaultLuggageItems]; } } else { luggageItems = [...defaultLuggageItems]; }
            renderLuggage();
        }
        function saveData() { localStorage.setItem(STORAGE_KEY, JSON.stringify(luggageItems)); renderLuggage(); }
        function addItem() {
            const name = document.getElementById('new-item-input').value.trim();
            if (!name) return;
            luggageItems.push({ id: Date.now(), item: name, category: document.getElementById('new-item-category').value, location: document.getElementById('new-item-location').value, note: document.getElementById('new-item-note').value, checked: false });
            document.getElementById('new-item-input').value = ''; document.getElementById('new-item-note').value = '';
            saveData();
        }
        function toggleCheck(id) { const item = luggageItems.find(i => i.id == id); if (item) { item.checked = !item.checked; saveData(); } }
        function openEdit(id) {
            currentEditId = id; const item = luggageItems.find(i => i.id == id); if (!item) return;
            document.getElementById('edit-item-name').value = item.item; document.getElementById('edit-item-note').value = item.note || '';
            const cats = ['é›œç‰©','3C','è¡£ç‰©','åŒ–å¦ã€ä¿é¤Š','é‡è¦']; const locs = ['å¤§ç®±','ç™»æ©Ÿç®±','éš¨èº«åŒ…'];
            document.getElementById('edit-item-category').innerHTML = cats.map(c => `<option value="${c}" ${c===item.category?'selected':''}>${c}</option>`).join('');
            document.getElementById('edit-item-location').innerHTML = locs.map(l => `<option value="${l}" ${l===item.location?'selected':''}>${l}</option>`).join('');
            document.getElementById('edit-modal').style.display = 'block';
        }
        function saveEdit() {
            const item = luggageItems.find(i => i.id == currentEditId);
            if (item) { item.item = document.getElementById('edit-item-name').value; item.category = document.getElementById('edit-item-category').value; item.location = document.getElementById('edit-item-location').value; item.note = document.getElementById('edit-item-note').value; saveData(); closeModal(); }
        }
        function openDelete(id) { itemToDeleteId = id; document.getElementById('delete-modal').style.display = 'block'; }
        function confirmDelete() { if (itemToDeleteId !== null) { luggageItems = luggageItems.filter(i => i.id != itemToDeleteId); saveData(); closeDeleteModal(); } }
        function closeDeleteModal() { itemToDeleteId = null; document.getElementById('delete-modal').style.display = 'none'; }
        function renderLuggage() {
            if(!luggageContainer) return; luggageContainer.innerHTML = '';
            if (luggageItems.length === 0) { luggageContainer.innerHTML = '<div class="text-center text-gray-400 text-sm p-4">æ¸…å–®ç›®å‰æ˜¯ç©ºçš„ï¼Œè«‹æ–°å¢ç‰©å“ã€‚</div>'; return; }
            [...luggageItems].sort((a, b) => { if(a.location !== b.location) return a.location.localeCompare(b.location, "zh-TW"); if(a.category !== b.category) return a.category.localeCompare(b.category, "zh-TW"); return a.checked - b.checked; }).forEach(item => {
                let locColor = 'bg-gray-100 text-gray-800'; if (item.location === 'å¤§ç®±') locColor = 'bg-blue-100 text-blue-800 border border-blue-200'; else if (item.location === 'ç™»æ©Ÿç®±') locColor = 'bg-green-100 text-green-800 border border-green-200'; else if (item.location === 'éš¨èº«åŒ…') locColor = 'bg-yellow-100 text-yellow-800 border border-yellow-200';
                const badgeColor = item.category === 'é‡è¦' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-600';
                luggageContainer.innerHTML += `<div class="flex items-start p-2 bg-gray-50 rounded border border-gray-100 hover:bg-white transition ${item.checked ? 'opacity-50' : ''}"><input type="checkbox" class="mt-1 mr-2 cursor-pointer" ${item.checked ? 'checked' : ''} onchange="toggleCheck('${item.id}')"><div class="flex-grow"><div class="flex gap-1 mb-1"><span class="text-xs px-1.5 rounded ${locColor}">${item.location}</span><span class="text-xs px-1.5 rounded ${badgeColor}">${item.category}</span></div><div class="font-medium text-sm text-jp-brown ${item.checked ? 'line-through' : ''}">${item.item}</div>${item.note ? `<div class="text-xs text-gray-500 mt-0.5">ğŸ“ ${item.note}</div>` : ''}</div><button onclick="openEdit('${item.id}')" class="text-blue-400 hover:text-blue-600 mx-1">âœï¸</button><button onclick="openDelete('${item.id}')" class="text-red-400 hover:text-red-600 mx-1">ğŸ—‘ï¸</button></div>`;
            });
        }

        const spotsData = [
            { name: "Chateraise PREMIUM YATSUDOKI Shiodome", type: "food", note: "ç”œé»/è›‹ç³•", map: "https://goo.gl/maps/search/Chateraise+PREMIUM+YATSUDOKI+Shiodome", lat: 35.6645, lng: 139.7588 },
            { name: "å·è±Šæœ¬åº—", type: "food", note: "æˆç”°é°»é­šé£¯è€åº—", map: "https://goo.gl/maps/search/å·è±Šæœ¬åº—", lat: 35.7796, lng: 140.3180 },
            { name: "é¯›ã”ã¯ã‚“æ‡çŸ³ ç“”ç", type: "food", note: "ç®±æ ¹é¯›é­šé£¯ (å·²è¨‚ä½)", map: "https://goo.gl/maps/search/é¯›ã”ã¯ã‚“æ‡çŸ³+ç“”ç", lat: 35.2345, lng: 139.0980 },
            { name: "ã¾ãã‚ã¨ã‚·ãƒ£ãƒª æµ…è‰åº—", type: "food", note: "é®ªé­šä¸¼é£¯", map: "https://goo.gl/maps/search/ã¾ãã‚ã¨ã‚·ãƒ£ãƒª+æµ…è‰åº—", lat: 35.7120, lng: 139.7960 },
            { name: "TokyoSushiBowl", type: "food", note: "å£½å¸ä¸¼", map: "https://goo.gl/maps/search/TokyoSushiBowl", lat: 35.6890, lng: 139.7000 },
            { name: "Monmouth Tea", type: "food", note: "åƒé¦±è°·å¥¶èŒ¶å°ˆè³£", map: "https://goo.gl/maps/search/Monmouth+Tea", lat: 35.6790, lng: 139.7070 },
            { name: "Kenyan Shibuya (ã‚±ãƒ‹ãƒ¤ãƒ³)", type: "food", note: "æ¾€è°·è€ç‰Œç´…èŒ¶åº—", map: "https://goo.gl/maps/search/Kenyan+Shibuya", lat: 35.6618, lng: 139.6970 },
            { name: "Marlowe å¸ƒä¸", type: "food", note: "æ©«é ˆè³€ Port Market åº—", address: "6 Shinkocho, Yokosuka, Kanagawa 238-0005æ—¥æœ¬", map: "https://goo.gl/maps/search/Marlowe+Yokosuka", lat: 35.2840, lng: 139.6680 },
            { name: "Tsunami", type: "food", note: "æ©«é ˆè³€æµ·è»æ¼¢å ¡/å’–å“©", address: "æ—¥æœ¬ã€’238-0041 Kanagawa, Yokosuka, Honcho, 2 Chome-1-9 é£¯ç”°ãƒ“ãƒ«", map: "https://goo.gl/maps/search/Tsunami+Yokosuka", lat: 35.2810, lng: 139.6670 },
            { name: "HONEY BEE", type: "food", note: "æ©«é ˆè³€ç¾è»æ¼¢å ¡", address: "æ—¥æœ¬ã€’238-0041 Kanagawa, Yokosuka, Honcho, 2 Chome-ï¼‘ æœ¬ç”ºãƒ“ãƒ« 1F ãƒãƒ‹ãƒ¼ãƒ“", map: "https://goo.gl/maps/search/HONEY+BEE+Yokosuka", lat: 35.2815, lng: 139.6675 },
            { name: "Wood Island Curry", type: "food", note: "æ©«é ˆè³€å’–å“©", map: "https://goo.gl/maps/search/Wood+Island+Yokosuka", lat: 35.2820, lng: 139.6680 },
            { name: "ç‰›ãŸã‚“ è’ æ–°å®¿åº—", type: "food", note: "åšåˆ‡ç‰›èˆŒ", map: "https://goo.gl/maps/search/ç‰›ãŸã‚“+è’+æ–°å®¿", lat: 35.6900, lng: 139.7000 },
            { name: "tonkatsu.jp Omotesando", type: "food", note: "é ‚ç´šç‚¸è±¬æ’", map: "https://goo.gl/maps/search/tonkatsu.jp+Omotesando", lat: 35.6653, lng: 139.7115 },
            { name: "Cafe La Boheme æ–°å®¿å¾¡è‹‘", type: "food", note: "ã€Šä½ çš„åå­—ã€‹å ´æ™¯é¤å»³", map: "https://goo.gl/maps/search/Cafe+La+Boheme+Shinjyuku+gyoen", lat: 35.6880, lng: 139.7100 },
            { name: "é‰„æ¿ç„¼ æµ…è‰ KUDAKA", type: "food", note: "éµæ¿ç‡’", map: "https://goo.gl/maps/search/é‰„æ¿ç„¼+æµ…è‰+KUDAKA", lat: 35.7130, lng: 139.7950 },
            { name: "ã†ã•ãã‚„CAFÃ‰", type: "food", note: "ä¸Šé‡éŠ…é‘¼ç‡’é¬†é¤…", map: "https://goo.gl/maps/search/ã†ã•ãã‚„CAFÃ‰", lat: 35.7070, lng: 139.7730 },
            { name: "CafÃ© Lapin", type: "food", note: "ä¸Šé‡å¾©å¤å’–å•¡å»³", map: "https://goo.gl/maps/search/CafÃ©+Lapin", lat: 35.7060, lng: 139.7740 },
            { name: "é­šå±‹ã‚„ã¾ã¡ã‚ƒã‚“", type: "food", note: "æµ·é®®å±…é…’å±‹", map: "https://goo.gl/maps/search/é­šå±‹ã‚„ã¾ã¡ã‚ƒã‚“", lat: 35.6895, lng: 139.7005 },
            { name: "æµ…è‰ç‰›å…‰", type: "food", note: "æ·ºè‰å’Œç‰›", map: "https://goo.gl/maps/search/æµ…è‰ç‰›å…‰", lat: 35.7125, lng: 139.7955 },
            { name: "é°»ç¦…", type: "food", note: "æ·ºè‰é°»é­šé£¯", map: "https://goo.gl/maps/search/é°»ç¦…", lat: 35.7100, lng: 139.8000 },
            { name: "æ°´å–œ Mizuki", type: "food", note: "æ·ºè‰åœŸé‹é£¯", address: "3 Chome-16-11 Nishiasakusa, Taito City, Tokyo 111-0035æ—¥æœ¬", map: "https://goo.gl/maps/search/æ°´å–œ+Mizuki", lat: 35.7140, lng: 139.7930 },
            { name: "å…«åå…«æµ…è‰", type: "food", note: "æŠ¹èŒ¶å°ˆè³£", map: "https://goo.gl/maps/search/å…«åå…«æµ…è‰", lat: 35.7150, lng: 139.7980 },
            { name: "å¾¡è“å­å¸ äº€å", type: "food", note: "æ·ºè‰éŠ…é‘¼ç‡’", map: "https://goo.gl/maps/search/å¾¡è“å­å¸+äº€å", lat: 35.7110, lng: 139.7970 },
            { name: "PATISSERIE TEN&", type: "food", note: "éŠ€åº§å¯éº—éœ²", map: "https://goo.gl/maps/search/PATISSERIE+TEN", lat: 35.6720, lng: 139.7650 },
            { name: "Marion Crepes Shibuya Modi", type: "food", note: "æ¾€è°·å¯éº—é¤…", map: "https://www.google.com/maps/search/?api=1&query=Marion+Crepes+Shibuya+Modi", lat: 35.6604, lng: 139.7005 },
            { name: "RINKAN è¥¿æ­¦æ–°å®¿ç«™åº—", type: "shopping", note: "äºŒæ‰‹ç²¾å“", map: "https://goo.gl/maps/search/RINKAN+è¥¿æ­¦æ–°å®¿", externalLink: "https://rinkan-online.com/products/10728-251019-0075", lat: 35.6950, lng: 139.7010 },
            { name: "å¤§æ¶Œè°·ãã‚ãŸã¾ã”é¤¨", type: "shopping", note: "é»‘è›‹ç´€å¿µå“", map: "https://goo.gl/maps/search/å¤§æ¶Œè°·ãã‚ãŸã¾ã”é¤¨", lat: 35.2420, lng: 139.0190 },
            { name: "CBD SHOP -YANAGI-", type: "shopping", note: "æ¾€è°·æœ¬åº— (CBNé¤…ä¹¾)", address: "æ—¥æœ¬ã€’150-0041 Tokyo, Shibuya, Jinnan, 1 Chome-12-16 1F è£å£", map: "https://goo.gl/maps/search/CBD+SHOP+YANAGI", lat: 35.6630, lng: 139.6990 },
            { name: "Vivienne Westwood Man", type: "shopping", note: "è¡¨åƒé“åº—", map: "https://goo.gl/maps/search/Vivienne+Westwood+Man+Omotesando", lat: 35.6660, lng: 139.7090 },
            { name: "Vivienne Westwood Red Label", type: "shopping", note: "åŸå®¿/è¡¨åƒé“", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 1 Chome-11-6 ãƒ©ãƒ•ã‚©ãƒ¼ãƒ¬åŸå®¿1F", map: "https://goo.gl/maps/search/Vivienne+Westwood+Red+Label", lat: 35.6690, lng: 139.7050 },
            { name: "Closet Child", type: "shopping", note: "Vivienne äºŒæ‰‹", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 1 Chome-7-6 Coxy176 ãƒ“ãƒ« 101", map: "https://goo.gl/maps/search/Closet+Child+Vivienne", lat: 35.6700, lng: 139.7060 },
            { name: "BEAMS åŸå®¿ Annex", type: "shopping", note: "æ½®æµæœé£¾", map: "https://goo.gl/maps/search/BEAMS+Harajuku+Annex", lat: 35.6710, lng: 139.7050 },
            { name: "GR8", type: "shopping", note: "åŸå®¿ Laforet ç²¾é¸åº—", map: "https://goo.gl/maps/search/GR8+Harajuku", lat: 35.6690, lng: 139.7050 },
            { name: "BEAMS JAPAN", type: "shopping", note: "æ–°å®¿æ—¥æœ¬é¸ç‰©", address: "æ—¥æœ¬ã€’160-0022 Tokyo, Shinjuku City, Shinjuku, 3 Chome-32-6 B1F 5F", map: "https://goo.gl/maps/search/BEAMS+JAPAN", lat: 35.6910, lng: 139.7020 },
            { name: "KITH TOKYO", type: "shopping", note: "æ¾€è°·å®®ä¸‹å…¬åœ’", map: "https://goo.gl/maps/search/KITH+TOKYO", lat: 35.6620, lng: 139.7020 },
            { name: "ä¼Šå‹¢ä¸¹ãƒ¡ãƒ³ã‚ºé¤¨", type: "shopping", note: "æ–°å®¿ç”·å£«é¤¨", map: "https://goo.gl/maps/search/Isetan+Men's", lat: 35.6920, lng: 139.7040 },
            { name: "HUMAN MADE åŸå®¿", type: "shopping", note: "æ½®æµå“ç‰Œ", map: "https://goo.gl/maps/search/HUMAN+MADE+Harajuku", lat: 35.6695, lng: 139.7055 },
            { name: "HUMAN MADE OFFLINE STORE", type: "shopping", note: "ä¸­ç›®é»‘/å¤–è‹‘å‰", map: "https://goo.gl/maps/search/HUMAN+MADE+OFFLINE+STORE", lat: 35.6720, lng: 139.7150 },
            { name: "éŠ€åº§ã‚«ãƒ¬ãƒ³ (Karen)", type: "shopping", note: "è¡Œæç®± (æ·ºè‰/æ—¥æœ¬æ©‹)", map: "https://goo.gl/maps/search/Ginza+Karen", lat: 35.6850, lng: 139.7750 },
            { name: "è‡ªå®¶è£½ä¸ƒå‘³ æ¾å®®", type: "shopping", note: "å·¢é´¨ä¸ƒå‘³ç²‰", map: "https://goo.gl/maps/search/Sugamo+Matsumiya", lat: 35.7330, lng: 139.7390 },
            { name: "Acro Tokyo", type: "shopping", note: "åŸå®¿ Laforet", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 1 Chome-11-6 ãƒ©ãƒ•ã‚©ãƒ¼ãƒ¬åŸå®¿ B1F", map: "https://goo.gl/maps/search/Acro+Tokyo+Laforet", lat: 35.6690, lng: 139.7050 },
            { name: "Nepenthes Tokyo", type: "shopping", note: "Needles æœ¬åº—", map: "https://goo.gl/maps/search/Nepenthes+Tokyo", lat: 35.6650, lng: 139.7080 },
            { name: "RINKAN æ¾€è°·åº—", type: "shopping", note: "æ½®æµäºŒæ‰‹", address: "æ—¥æœ¬ã€’150-0041 Tokyo, Shibuya, Jinnan, 1 Chome-12-16 å’Œå…‰ ãƒ“ãƒ« 1Fï½¥2F", map: "https://goo.gl/maps/search/RINKAN+Shibuya", externalLink: "https://rinkan-online.com/products/10211-250729-0079", lat: 35.6625, lng: 139.7000 },
            { name: "STUDIOUS", type: "shopping", note: "åŸå®¿/æ¾€è°·", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 4 Chome-26-32 1F", map: "https://goo.gl/maps/search/STUDIOUS+Tokyo", lat: 35.6680, lng: 139.7060 },
            { name: "STUDIOUS TOKYO è¡¨å‚é“", type: "shopping", note: "åŸå®¿æœ¬åº—", map: "https://goo.gl/maps/search/STUDIOUS+TOKYO+Omotesando", lat: 35.6660, lng: 139.7090 },
            { name: "EchirÃ© Maison du Beurre", type: "shopping", note: "ä¸¸ä¹‹å…§è‰¾è¨±å¥¶æ²¹", map: "https://goo.gl/maps/search/EchirÃ©+Maison+du+Beurre+Marunouchi", lat: 35.6784, lng: 139.7617 },
            { name: "BUTTER ç¾ç‘›æ”¾ç‰§é…ªè¾²å ´", type: "shopping", note: "ä¸¸ä¹‹å…§/å¥¶æ²¹ç”œé»", map: "https://www.google.com/maps/search/?api=1&query=BUTTER+ç¾ç‘›æ”¾ç‰§é…ªè¾²å ´", lat: 35.6812, lng: 139.7641 },
            { name: "æ·ºè‰èŠ±ç­", type: "sightseeing", note: "å’Œæœç§Ÿå€Ÿ", map: "https://goo.gl/maps/search/Asakusa+Hanaikada", lat: 35.7120, lng: 139.7970 },
            { name: "é ˆè³€ç¥ç¤¾ ç”·æ®µ", type: "sightseeing", note: "ã€Šä½ çš„åå­—ã€‹éšæ¢¯", map: "https://goo.gl/maps/search/Suga+Shrine+Stairs", lat: 35.6850, lng: 139.7220 },
            { name: "è–æ©‹ (Hijiri Bridge)", type: "sightseeing", note: "ã€Šéˆ´èŠ½ä¹‹æ—…ã€‹å ´æ™¯", map: "https://goo.gl/maps/search/Hijiri+Bridge", lat: 35.6990, lng: 139.7650 },
            { name: "å¹³å’Œã®é³¥å±…", type: "sightseeing", note: "ç®±æ ¹ç¥ç¤¾æ°´ä¸­é³¥å±…", map: "https://goo.gl/maps/search/Heiwa+no+Torii", lat: 35.2030, lng: 139.0270 },
            { name: "è˜†ä¹‹æ¹–", type: "sightseeing", note: "ç®±æ ¹æµ·è³Šèˆ¹", map: "https://goo.gl/maps/search/Lake+Ashi", lat: 35.2100, lng: 139.0050 },
            { name: "æ­Œèˆä¼ç”ºä¸€ç•ªè¡—", type: "sightseeing", note: "æ–°å®¿åœ°æ¨™", map: "https://goo.gl/maps/search/Kabukicho+Ichibangai", lat: 35.6940, lng: 139.7010 },
            { name: "YOKOSUKA è»æ¸¯å·¡èˆª", type: "sightseeing", note: "æ©«é ˆè³€éŠèˆ¹", map: "https://goo.gl/maps/search/Yokosuka+Naval+Port+Cruise", lat: 35.2845, lng: 139.6650 },
            { name: "å¤–è‹‘éŠ€æä¸¦æœ¨", type: "sightseeing", note: "æ˜æ²»ç¥å®®å¤–è‹‘", map: "https://goo.gl/maps/search/Meiji+Jingu+Gaiem+Ginkgo+Avenue", lat: 35.6730, lng: 139.7220 },
            { name: "å¾…ä¹³å±± æœ¬é¾é™¢", type: "sightseeing", note: "æ·ºè‰èƒ½é‡æ™¯é»", map: "https://goo.gl/maps/search/Matsuchiyama+Shoden", lat: 35.7180, lng: 139.8020 },
            { name: "ä¸‹åŒ—æ²¢ SHELTER", type: "sightseeing", note: "ã€Šå­¤ç¨æ–æ»¾ã€‹Live House", map: "https://goo.gl/maps/search/Shimokitazawa+SHELTER", lat: 35.6610, lng: 139.6670 },
            { name: "æ¾€è°·å…¨å‘åå­—è·¯å£", type: "sightseeing", note: "Shibuya Crossing", map: "https://goo.gl/maps/search/Shibuya+Crossing", lat: 35.6595, lng: 139.7005 },
            { name: "åƒèº°å­è‚²åœ°è”µè©è–©", type: "sightseeing", note: "å¢ä¸Šå¯º", map: "https://goo.gl/maps/search/Zojoji+Jizo", lat: 35.6570, lng: 139.7480 },
            { name: "è¿è³“é¤¨èµ¤å‚é›¢å®®", type: "sightseeing", note: "è¥¿æ´‹å®®æ®¿", map: "https://goo.gl/maps/search/Akasaka+Palace", lat: 35.6800, lng: 139.7290 },
            { name: "çš‡å±…", type: "sightseeing", note: "äºŒé‡æ©‹", map: "https://goo.gl/maps/search/Imperial+Palace+Tokyo", lat: 35.6850, lng: 139.7520 },
            { name: "æˆç”°å±±æ–°å‹å¯º", type: "sightseeing", note: "æˆç”°æ©Ÿå ´é™„è¿‘", map: "https://goo.gl/maps/search/Naritasan+Shinshoji", lat: 35.7860, lng: 140.3180 },
            { name: "SHIBUYA SKY", type: "sightseeing", note: "æ¾€è°·é«˜ç©ºå±•æœ›å°", map: "https://goo.gl/maps/search/SHIBUYA+SKY", lat: 35.6585, lng: 139.7020 },
            { name: "æ˜æ²»ç¥å®®", type: "sightseeing", note: "åŸå®¿", map: "https://goo.gl/maps/search/Meiji+Jingu", lat: 35.6760, lng: 139.6990 },
            { name: "æµ…è‰æ–‡åŒ–è¦³å…‰ã‚»ãƒ³ã‚¿ãƒ¼", type: "sightseeing", note: "çœºæœ›æ·ºè‰å¯º", map: "https://goo.gl/maps/search/Asakusa+Culture+Tourist+Information+Center", lat: 35.7106, lng: 139.7965 },
            { name: "KALEDOTOWER (å¾…ç¢ºèª)", type: "sightseeing", note: "åœ°é»éœ€ç¢ºèª", map: "https://www.google.com/maps", lat: 35.6895, lng: 139.6917 }
        ];

        const shoppingList = [
            { 
                category: "è—¥å¦ä¿é¤Š", 
                name: "ã€plus eauã€‘ç€æµ·é€ å‹é­”æ³•æ£’", 
                location: "Loft/Plaza/æ¾æœ¬æ¸…", 
                tag: "Drugstore",
                image: "https://lh7-rt.googleusercontent.com/sheetsz/AHOq17H9zeSenqwoDIlq0Fq3Cx0FNVX707Aky8mIjjbaVjk0etTbXudJsTO1Jslbr3HCCl78VB3jrN51SgMFbUyFU2jq6DBWYINzcIXMF3xgrQbV4aWHfx_TOZKldd3_4MG5J5tIaDEf0QHPMQyJwQRrKxPykiPe?key=GIdYLBhCljRantezzAd-jA"
            },
            { 
                category: "è—¥å¦ä¿é¤Š", 
                name: "EVEæ­¢ç—›è—¥", 
                location: "å„è—¥å¦åº—", 
                tag: "Drugstore",
                image: "https://lh7-rt.googleusercontent.com/sheetsz/AHOq17GT1d0qAgZeaAjFDIBO7dCR6FPd_gjcCd9t0uwjXUTZ-ZZz3qi8iNC9G6PE5EJe4mS3mSPbUJNcnfiz4jtI1QxIoNV_Tq4wGb4VVRyWkCrrtoJ3PPMhrzAgXyRrSGePk7o97EieQvNU6QEeylWecvYvSHVz?key=GIdYLBhCljRantezzAd-jA"
            },
            { 
                category: "è—¥å¦ä¿é¤Š", 
                name: "Kiss meã€Œç«æ¯›å®šå‹æ¶²ã€", 
                location: "å„è—¥å¦åº—/Donki", 
                tag: "Drugstore",
                image: "https://lh7-rt.googleusercontent.com/sheetsz/AHOq17EsNLbYxOh3P5oIM61T6Rl_OEccpgv67w_3MHEjVkZlKee2e4-yE6TganNzMZtAsTmcT3r1JEaCJzEFa4IqaQd2j00OpKEByQmdYK9nrPF_0NEBiTGPhJU2vFpeiz8o9x3HZnwsBprIwoJzJkFWrP-rWhE?key=GIdYLBhCljRantezzAd-jA"
            },
            { 
                category: "è—¥å¦ä¿é¤Š", 
                name: "Melté«ªåŒ–ç²§æ°´", 
                location: "Loft/Plaza", 
                tag: "Drugstore",
                image: "https://lh7-rt.googleusercontent.com/sheetsz/AHOq17EPxa0HLPyzCgrDCW6_bRIuno2MmGOsXOH9InRsrTxgJijJc5SxSKNJqeMP-W_48BhbnlWZSBfWY5DJeAAWh-Ghs46cb0WCArXeVMExzfvURMFZxyR6gHvMyl-6ionGYtWFW-aW-y-B3Qn-8AIhrmIBQp4?key=GIdYLBhCljRantezzAd-jA"
            },
            { 
                category: "è—¥å¦ä¿é¤Š", 
                name: "UHAå‘³è¦ºç³–è£œéµç‡Ÿé¤Šè»Ÿç³–", 
                location: "å„è—¥å¦åº—/è¶…å•†", 
                tag: "Drugstore",
                image: "https://lh7-rt.googleusercontent.com/sheetsz/AHOq17GtFCsp-qhvAXjGJUd5zlv5vC3l15oRHhIZZmFMyzJgMtl3KKJNTAEzuQ0Uhk9mEpWS9GIb3_snAqNJH3_lb_LfsTgNsUtTN4zM4iadRZt0H61tNXITYEQ-kl6IGRNzbLm7ULAPxWeahg3-wFwNhiwVulYY?key=GIdYLBhCljRantezzAd-jA"
            },
            { 
                category: "è—¥å¦ä¿é¤Š", 
                name: "Cp-Lip å”‡éƒ¨ç²¾è¯æ¶²", 
                location: "å„è—¥å¦åº—", 
                tag: "Drugstore",
                image: "https://sakurayala.com/cdn/shop/files/05931487-2AC4-43C4-B7E0-916429CD6E11.jpg?v=1763238799&width=600"
            },
            { 
                category: "è—¥å¦ä¿é¤Š", 
                name: "SOFINA iP ç²¾è¯ä¹³éœœ", 
                location: "æ¾æœ¬æ¸…/å°ˆæ«ƒ", 
                tag: "Drugstore",
                image: "https://kao-h.assetsadobe3.com/is/image/content/dam/sites/kao/web-sofina-com/hk/ip/v3/products/moisturecareshot/pc/products_img_v2.png?fmt=webp&wid=640"
            },
            { category: "ç¾ç³éš±çœ¼", name: "éš±çœ¼ (BARRIEYES)", location: "Donki/BicContact", tag: "Contact" },
            { category: "ç¾ç³éš±çœ¼", name: "éš±çœ¼ (GAL NEVER DIE)", location: "Donki", tag: "Contact" },
            { category: "ç¾ç³éš±çœ¼", name: "éš±çœ¼ (NS COLLECTION)", location: "Donki", tag: "Contact" },
            { 
                category: "ç”Ÿæ´»é›œè²¨/é›»å™¨", 
                name: "3coinså¾®æ³¢çˆçƒ¤ç›¤", 
                location: "3COINS", 
                tag: "Variety",
                image: "https://lh7-rt.googleusercontent.com/sheetsz/AHOq17HhrA_pDoPeoM2hnoHJ5JF7KK3vSWSKSNs7k9jzKwIq7olB4JZXG3hz5irdB63CFSW3OXGYOhDdarWJQzHe101t6eDe5WcYFgfJqoySolhch6TXKH5B6u-XB0wOjGtj79O760rDViq6Mgi20QZm1etXcXgc?key=GIdYLBhCljRantezzAd-jA"
            },
            { 
                category: "ç”Ÿæ´»é›œè²¨/é›»å™¨", 
                name: "recolteèª¿ç†æ©Ÿ", 
                location: "Bic/Yodobashi", 
                tag: "Variety",
                image: "https://scontent.ftpe8-3.fna.fbcdn.net/v/t39.30808-6/486165925_1087625106734088_7696211871505451010_n.jpg?_nc_cat=107&ccb=1-7&_nc_sid=127cfc&_nc_ohc=QU2VvGqj1Q0Q7kNvwEQGqhZ&_nc_oc=AdmcZlz5C0aDqepttXn7ABnLd_Oc08s9lIhYPv-1mq0qwZL82D9MAsgn6WAOawwyzZw&_nc_zt=23&_nc_ht=scontent.ftpe8-3.fna&_nc_gid=TWdy91AXSkEWGsKIX1Si-w&oh=00_AfkPeroTWMibA3pIbETwT9sC3Qa6EAEZEZlv3oOlwS4wpQ&oe=693578C0"
            },
            { 
                category: "æœé£¾é…ä»¶", 
                name: "é´ä¸‹å±‹çš„ä¿æš–è¤²è¥ª", 
                location: "Tabio/é´ä¸‹å±‹", 
                tag: "Fashion",
                note: "è²·80ä¸¹ä»¥ä¸‹ï¼Œæ¨è–¦è‰²è™Ÿ34",
                externalLink: "https://tabio.com/jp/corporate/store/"
            }
        ];

        const itineraryDetails = {
            day1: [
                { time: "06:35", title: "æŠµé”æˆç”°æ©Ÿå ´ T3", desc: "å…¥å¢ƒã€‚", recommended: false },
                { time: "08:13", title: "N'EX æˆç”°ç‰¹å¿«", desc: "å¾€æ–°å®¿ (09:47 æŠµ)ã€‚", recommended: false },
                { time: "10:00", title: "å°ç”°æ€¥æµªæ¼«ç‰¹å¿«", desc: "å¾€ç®±æ ¹æ¹¯æœ¬ (11:27 æŠµ)ã€‚", recommended: false },
                { 
                    time: "12:15", title: "åˆé¤ï¼šé¯›ã”ã¯ã‚“æ‡çŸ³ ç“”ç", desc: "â˜… å·²è¨‚ä½ 12:15ã€‚", recommended: false,
                    diningOptions: [
                        { name: "ã¯ã¤èŠ±ãã° æœ¬åº—", note: "è‡ªç„¶è–¯è•éº¥éºµ", rating: "3.58", price: "ï¿¥1,200~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Hatsuhana+Soba+Hakone", inMap: false },
                        { name: "æ¹¯è‘‰ä¸¼ ç›´å‰", note: "æ¹¯è‘‰ä¸¼", rating: "3.49", price: "ï¿¥1,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Yubadon+Naokichi", inMap: false }
                    ]
                },
                { time: "13:00", title: "ç®±æ ¹ç¶“å…¸ç’°éŠ", desc: "ç™»å±±é›»è»Š/çºœè»Š/å¤§æ¹§è°·ã€‚", recommended: false },
                { 
                    time: "15:50", 
                    title: "ç®±æ ¹æµ·è³Šèˆ¹", 
                    desc: "æ¡ƒæºå°â†’å…ƒç®±æ ¹æ¸¯ã€‚æ‹é³¥å±…ã€‚<br><a href='https://lh7-rt.googleusercontent.com/sheetsz/AHOq17HFvazLjHEXiwMsrr15MIptcT4F1R98IdyXqGyX6Oq1zqvUJCv4Xy81p2TbuAWWa4sxxfIcWveuQBLolIF7Tjr-3SeFZldZKfc32f7KsX6DSUPM-J0Gv6cqVNCPKEYpIrtvtQagFA8SHXPKYPyTK5krfW8_?key=GIdYLBhCljRantezzAd-jA' target='_blank' class='text-blue-500 hover:underline font-bold inline-flex items-center mt-1'>ğŸš¢ æ™‚åˆ»è¡¨</a>", 
                    recommended: false 
                },
                { 
                    time: "18:00", title: "æ™šé¤ï¼šç®±æ ¹ç•¶åœ°æ–™ç†", desc: "è»Šç«™é™„è¿‘æˆ–é£¯åº—è‡ªåŠ©é¤ã€‚", recommended: false,
                    diningOptions: [
                         { name: "çŸ¥å®¢èŒ¶å®¶", note: "è±†è…/å±±è—¥", rating: "3.51", price: "ï¿¥2,000~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Shikajaya+Hakone", inMap: false },
                         { name: "å–œä¹‹åŠ©", note: "é®®é­šå±…é…’å±‹", rating: "3.49", price: "ï¿¥3,000~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Kinosuke+Hakone", inMap: false }
                    ]
                },
                { time: "20:00", title: "æº«æ³‰ & ä¼‘æ¯", desc: "å…¥ä½ Hakone Pax Yoshinoã€‚", recommended: false }
            ],
            day2: [
                { 
                    time: "09:30", title: "å‰å¾€æ©«é ˆè³€", 
                    desc: "JR (11:04 æŠµ)ã€‚<br><a href='https://world.jorudan.co.jp/mln/zh-tw/?p=50&from=%e7%ae%b1%e6%a0%b9%e6%b9%af%e6%9c%ac&to=%e6%a9%ab%e9%a0%88%e8%b3%80&date=2025%2f12%2f06&time=09%3a35&ft=0&ic=0&ut=0&up=0&us=0&nzm=0&sub_lang=ja&route=1' target='_blank' class='text-blue-500 hover:underline font-bold mt-1 inline-block'>ğŸ”— æŸ¥çœ‹ä¹˜è»Šè·¯ç·š (Jorudan)</a>", 
                    recommended: false 
                },
                { time: "12:00", title: "è»æ¸¯å·¡èˆª", desc: "â˜… é ç´„ 12:00 èˆ¹ç­ã€‚", recommended: false },
                { 
                    time: "13:00", title: "åˆé¤ï¼šHONEY BEE", desc: "ç¾è»æ¼¢å ¡ã€‚", recommended: false,
                    diningOptions: [
                        { name: "Tsunami", note: "æµ·è»å’–å“©/æ¼¢å ¡", rating: "3.49", price: "ï¿¥1,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Tsunami+Yokosuka", inMap: true },
                        { name: "Wood Island Curry", note: "æ©«é ˆè³€å’–å“©", rating: "3.48", price: "ï¿¥1,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Wood+Island+Yokosuka", inMap: true }
                    ]
                },
                { 
                    time: "15:45", title: "å‰å¾€æ±äº¬æ°‘å®¿", 
                    desc: "ç§‹è‘‰åŸ/æœ«å»£ç”ºã€‚17:30 Check-inã€‚<br><a href='https://world.jorudan.co.jp/mln/zh-tw/?p=50&from=%e6%a9%ab%e9%a0%88%e8%b3%80&to=%e7%a7%8b%e8%91%89%e5%8e%9f&date=2025%2f12%2f06&time=15%3a00&ft=0&ic=0&ut=0&up=0&us=0&nzm=0&sub_lang=ja&route=6' target='_blank' class='text-blue-500 hover:underline font-bold mt-1 inline-block'>ğŸ”— æŸ¥çœ‹ä¹˜è»Šè·¯ç·š (Jorudan)</a>", 
                    recommended: false 
                },
                { 
                    time: "18:30", title: "æ™šé¤ï¼štonkatsu.jp Omotesando", desc: "é ‚ç´šç‚¸è±¬æ’ (éœ€é ç´„)ã€‚", recommended: true, recText: "æ¨è–¦",
                    diningOptions: [
                        { name: "tonkatsu.jp", note: "é ‚ç´šç‚¸è±¬æ’", rating: "4.20", price: "ï¿¥3,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=tonkatsu.jp+Omotesando", inMap: false },
                        { name: "éŠ€åº§ ç¯", note: "é›ç™½æ¹¯æ‹‰éºµ", rating: "3.58", price: "ï¿¥1,200~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Ginza+Kagari+Roppongi", inMap: false }
                    ]
                },
                { time: "20:30", title: "è³¼ç‰©ï¼šGinza Karen", desc: "äººå½¢ç”ºè²·è¡Œæç®±ã€‚", recommended: false }
            ],
            day3: [
                { time: "09:00", title: "çš‡å±… (äºŒé‡æ©‹)", desc: "äºŒé‡æ©‹å‰ç«™ã€‚", recommended: false },
                { time: "10:30", title: "èµ¤å‚é›¢å®®", desc: "åƒè§€æœ¬é¤¨/åº­åœ’ã€‚", recommended: false },
                { 
                    time: "12:30", title: "åˆé¤ & éŠ€æä¸¦æœ¨", desc: "æ˜æ²»ç¥å®®å¤–è‹‘éŠ€æç¥­ã€‚", recommended: true, recText: "æ¨è–¦ï¼šShake Shack",
                    diningOptions: [
                        { name: "Cafe La Boheme", note: "ã€Šä½ çš„åå­—ã€‹é¤å»³", rating: "3.45", price: "ï¿¥1,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Cafe+La+Boheme+Shinjyuku+gyoen", inMap: true },
                        { name: "ã¾ã„æ³‰ é’å±±", note: "ç‚¸è±¬æ’", rating: "3.58", price: "ï¿¥1,800~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Tonkatsu+Maisen+Aoyama", inMap: false }
                    ]
                },
                { time: "14:30", title: "åŸå®¿ / è¡¨åƒé“", desc: "KITH, BEAMS, Human Madeã€‚", recommended: false },
                { 
                    time: "16:00", 
                    title: "SHIBUYA SKY", 
                    desc: "â˜… å·²è³¼è²· 16:00 æ—¥è½å ´æ¬¡ã€‚<br><div class='mt-1 space-x-3'><a href='https://photos.app.goo.gl/6DxJ2CmoyrpvVNxF7' target='_blank' class='text-blue-500 hover:underline font-bold inline-flex items-center'>ğŸ« ç¥¨åˆ¸ 1/2</a><a href='https://photos.app.goo.gl/QYpFLoH3j8ocDuy18' target='_blank' class='text-blue-500 hover:underline font-bold inline-flex items-center'>ğŸ« ç¥¨åˆ¸ 2/2</a></div>", 
                    recommended: false 
                },
                { time: "18:00", title: "æ¾€è°· PARCO/Donki", desc: "ä»»å¤©å ‚, è—¥å¦ã€‚", recommended: false },
                { 
                    time: "19:30", title: "æ™šé¤ï¼šç‰›ãŸã‚“ è’", desc: "åšåˆ‡ç‰›èˆŒã€‚", recommended: false,
                    diningOptions: [
                        { name: "Kenyan Shibuya", note: "ç´…èŒ¶/è¼•é£Ÿ", rating: "3.55", price: "ï¿¥1,000~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Kenyan+Shibuya", inMap: true },
                        { name: "ã‹ã¤ã©ã‚“å±‹ ç‘å…†", note: "è±¬æ’ä¸¼", rating: "3.68", price: "ï¿¥1,000~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Katsudon-ya+Zuicho", inMap: false }
                    ]
                }
            ],
            day4: [
                { time: "09:00", title: "æ·ºè‰å’Œæœ", desc: "æ·ºè‰èŠ±ç­ã€‚", recommended: false },
                { time: "10:30", title: "æ·ºè‰å¯º / é›·é–€", desc: "æ‹ç…§é»ï¼šæ·ºè‰å¯ºæ­£é¢éšæ¢¯ä¸Šå»å¾Œå…©æ—çš„ç©ºé–“ï¼Œäººå°‘ä¹Ÿå¯ä»¥æ‹åˆ°æ·ºè‰å¯º/é›·é–€é¦¬è·¯å°é¢/ä»Šæˆ¶ç¥ç¤¾ã€å¾…ä¹³å±±è–å¤©(ç¨é èµ°è·¯20åˆ†)ã€‚", recommended: false },
                { 
                    time: "12:30", title: "åˆé¤ï¼šæ·ºè‰ç¾é£Ÿ", desc: "å’Œç‰› / åœŸé‹é£¯ / å£½å¸ã€‚", recommended: false,
                    diningOptions: [
                        { name: "é°»ç¦…", note: "é°»é­šé£¯", rating: "3.80", price: "ï¿¥4,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Unazen+Asakusa", inMap: true },
                        { name: "æ°´å–œ Mizuki", note: "åœŸé‹é£¯", rating: "3.45", price: "ï¿¥2,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Mizuki+Asakusa", inMap: true }
                    ]
                },
                { time: "14:30", title: "æ°´ä¸Šå·´å£«", desc: "â˜… é ç´„ï¼šæ·ºè‰ â†’ æµœé›¢å®®ã€‚", recommended: false },
                { time: "15:30", title: "æ±äº¬éµå¡”", desc: "æ‹ç…§é»ï¼šåƒè»€å­è‚²åœ°è—å°Šæ­¥é“ã€è±†è…å±‹åœè»Šå ´ã€KALEDOTOWER METROå¾æ±ç•™-èµ¤ç¾½æ©‹ã€‚", recommended: false },
                { 
                    time: "17:30", title: "éŠ€åº§é€›è¡— & æ™šé¤", desc: "è²·å¯éº—éœ²ï¼Œåƒæ™šé¤ã€‚", recommended: true, recText: "æ¨è–¦ï¼šPATISSERIE TEN&",
                    diningOptions: [
                        { name: "éŠ€åº§ ç¯ æœ¬åº—", note: "é›ç™½æ¹¯", rating: "3.78", price: "ï¿¥1,300~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Ginza+Kagari", inMap: false },
                        { name: "èŠ±å±±ã†ã©ã‚“", note: "å¯¬çƒé¾éºµ", rating: "3.60", price: "ï¿¥1,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Hanayama+Udon+Ginza", inMap: false }
                    ]
                }
            ],
            day5: [
                { time: "09:30", title: "é€€æˆ¿", desc: "å¾€æ±äº¬ç«™ã€‚", recommended: false },
                { time: "10:00", title: "æ±äº¬è»Šç«™ä¸€ç•ªè¡—", desc: "å‹•æ¼«è¡—ã€ä¼´æ‰‹ç¦®ã€‚", recommended: false },
                { 
                    time: "12:30", title: "åˆé¤ï¼šæ‹‰éºµè¡—/KITTE", desc: "æ‹‰éºµæˆ–å£½å¸ã€‚", recommended: false,
                    diningOptions: [
                        { name: "å…­å˜èˆ", note: "æ²¾éºµ", rating: "3.77", price: "ï¿¥1,100~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Rokurinsha+Tokyo+Station", inMap: false },
                        { name: "ã¤ã˜åŠ", note: "æµ·é®®ç å¯¶ç›’", rating: "3.75", price: "ï¿¥1,500~", mapUrl: "https://www.google.com/maps/search/?api=1&query=Tsujihan+Nihonbashi", inMap: false }
                    ]
                },
                { time: "14:00", title: "å‰å¾€æ©Ÿå ´ T1", desc: "N'EX (15:10 æŠµ)ã€‚è¨—é‹ã€‚", recommended: false },
                { time: "15:40", title: "æŠ˜è¿”æˆç”°ç«™", desc: "å·è±Šæœ¬åº—æŠ½è™Ÿç¢¼ç‰Œåƒé°»é­šã€‚", recommended: true, recText: "æ¨è–¦ï¼šå·è±Š æœ¬åº—" },
                { time: "17:30", title: "è¿”å›æ©Ÿå ´ T1", desc: "äº¬æˆæˆç”° â†’ T1ã€‚", recommended: false },
                { time: "17:45", title: "å…ç¨…åº—", desc: "æœ€å¾Œæ¡è²·ã€‚", recommended: false },
                { time: "19:55", title: "èµ·é£›", desc: "TR875ã€‚", recommended: false }
            ]
        };

        /* --- Location Helper Functions --- */
        let userLocation = { lat: null, lng: null };

        // Haversine formula to calculate distance (in km)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the earth in km
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; 
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }

        function formatDistance(distKm) {
            if (distKm < 1) {
                return Math.round(distKm * 1000) + "m";
            }
            return distKm.toFixed(1) + "km";
        }

        function refreshLocation() {
            if (navigator.geolocation) {
                const btn = document.getElementById('refresh-loc-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = "â³";
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        btn.innerHTML = originalText;
                        // Refresh current list with new location data
                        const activeFilterBtn = document.querySelector('.filter-btn.active');
                        if(activeFilterBtn) {
                            renderSpotsList(activeFilterBtn.dataset.filter);
                        }
                        alert("å®šä½å·²æ›´æ–°ï¼");
                    },
                    (error) => {
                        btn.innerHTML = originalText;
                        alert("ç„¡æ³•ç²å–ä½ç½®: " + error.message);
                    }
                );
            } else {
                alert("ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½");
            }
        }

        /* --- Updated Render Logic for Spots --- */
        function renderSpotsList(filter = 'all') {
            if(!spotsListContainer) return;
            spotsListContainer.innerHTML = '';
            
            // Toggle refresh button visibility
            const refreshBtn = document.getElementById('refresh-loc-btn');
            if (filter !== 'all') {
                if(refreshBtn) refreshBtn.classList.remove('hidden');
            } else {
                if(refreshBtn) refreshBtn.classList.add('hidden');
            }

            // Logic to determine if we should sort by distance
            const shouldSortByDist = (filter !== 'all' && userLocation.lat !== null);

            let displayData = [];

            // 1. Filter Data
            if (filter === 'nearest') {
                // Keep 'nearest' logic separate (filtering < 1km or closest)
                if (!userLocation.lat) {
                    spotsListContainer.innerHTML = '<div class="text-center p-4 text-gray-500">æ­£åœ¨ç²å–æ‚¨çš„ä½ç½®...</div>';
                    refreshLocation(); // Try to auto-refresh
                    return;
                }
                displayData = spotsData; 
            } else {
                displayData = filter === 'all' ? spotsData : spotsData.filter(s => s.type === filter);
            }

            // 2. Calculate Distances (always do this if loc exists, so badges show up)
            if (userLocation.lat) {
                displayData = displayData.map(spot => {
                    const dist = calculateDistance(userLocation.lat, userLocation.lng, spot.lat, spot.lng);
                    return { ...spot, dist };
                });
            }

            // 3. Special handling for 'nearest' filter logic (filtering)
            if (filter === 'nearest' && userLocation.lat) {
                displayData.sort((a, b) => a.dist - b.dist);
                const nearSpots = displayData.filter(s => s.dist <= 1.0);
                if (nearSpots.length > 0) displayData = nearSpots;
                else displayData = [displayData[0]]; // fallback to closest
            }

            // 4. Sort by Distance if required (for category pages)
            if (shouldSortByDist && filter !== 'nearest') {
                displayData.sort((a, b) => a.dist - b.dist);
            } else if (filter === 'all') {
                // Sort by Category then Alphabetically for 'all' category
                const typeOrder = { 'food': 1, 'shopping': 2, 'sightseeing': 3 };
                displayData.sort((a, b) => {
                    const typeDiff = (typeOrder[a.type] || 99) - (typeOrder[b.type] || 99);
                    if (typeDiff !== 0) return typeDiff;
                    return a.name.localeCompare(b.name, 'ja');
                });
            }
            
            if (displayData.length === 0) {
                 const msg = (filter === 'nearest') ? "é™„è¿‘æ²’æœ‰æ‰¾åˆ°åœ°é»ã€‚" : "æ­¤åˆ†é¡æ²’æœ‰è³‡æ–™ã€‚";
                 spotsListContainer.innerHTML = `<div class="text-center p-4 text-gray-500">${msg}</div>`;
                 return;
            }

            displayData.forEach(spot => {
                let badgeColor = ''; let typeLabel = '';
                switch(spot.type) {
                    case 'food': badgeColor = 'bg-jp-red text-white'; typeLabel = 'ç¾é£Ÿ'; break;
                    case 'shopping': badgeColor = 'bg-jp-gold text-white'; typeLabel = 'è³¼ç‰©'; break;
                    case 'sightseeing': badgeColor = 'bg-jp-brown text-white'; typeLabel = 'æ™¯é»'; break;
                }
                const card = document.createElement('div');
                card.className = "bg-white p-2 rounded border border-gray-200 spot-item";
                card.dataset.name = spot.name;
                card.onclick = (e) => { if(e.target.tagName !== 'A') updateMap(spot.name); };
                
                let linkHtml = spot.externalLink ? `<a href="${spot.externalLink}" target="_blank" class="text-blue-500 hover:text-blue-700 ml-1">ğŸ”—</a>` : '';
                
                // Distance badge logic
                let distHtml = '';
                if (spot.dist !== undefined) {
                    const distClass = spot.dist <= 1.0 ? 'dist-near' : '';
                    distHtml = `<span class="dist-badge ${distClass}">${formatDistance(spot.dist)}</span>`;
                }

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <div class="flex-grow">
                            <h4 class="font-bold text-jp-brown text-sm flex items-center flex-wrap">
                                ${spot.name}
                                ${linkHtml}
                            </h4>
                        </div>
                        <div class="flex flex-col items-end gap-1 ml-2">
                            <span class="text-xs px-1.5 py-0.5 rounded ${badgeColor} whitespace-nowrap">${typeLabel}</span>
                            ${distHtml}
                        </div>
                    </div>
                    <p class="text-xs text-gray-600">${spot.note}</p>
                `;
                spotsListContainer.appendChild(card);
            });
        }

        /* --- Event Listeners --- */
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => { 
                filterBtns.forEach(b => b.classList.remove('active', 'bg-jp-brown', 'text-white')); 
                btn.classList.add('active', 'bg-jp-brown', 'text-white'); 
                renderSpotsList(btn.dataset.filter); 
            });
        });

        function scrollToNavBtn(btn) {
            const container = document.getElementById('navbar-scroll-container');
            const scrollLeft = btn.offsetLeft - (container.offsetWidth / 2) + (btn.offsetWidth / 2);
            container.scrollTo({ left: scrollLeft, behavior: 'smooth' });
        }

        let touchStartX = 0; let touchStartY = 0; let touchEndX = 0; let touchEndY = 0;
        
        function switchTab(index) {
            if (index < 0 || index >= navBtns.length) return;
            const targetBtn = navBtns[index];
            navBtns.forEach(b => b.classList.remove('active'));
            sections.forEach(s => s.classList.remove('active'));
            targetBtn.classList.add('active');
            document.getElementById(targetBtn.dataset.section).classList.add('active');
            scrollToNavBtn(targetBtn);
        }

        navBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => { switchTab(index); });
        });

        mainContent.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; touchStartY = e.changedTouches[0].screenY; }, {passive: true});
        mainContent.addEventListener('touchend', e => { touchEndX = e.changedTouches[0].screenX; touchEndY = e.changedTouches[0].screenY; handleSwipe(); }, {passive: true});

        function handleSwipe() {
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;
            if (Math.abs(diffX) > 50 && Math.abs(diffY) < 100) {
                let currentIndex = -1;
                navBtns.forEach((btn, index) => { if (btn.classList.contains('active')) currentIndex = index; });
                if (diffX > 0 && currentIndex > 0) switchTab(currentIndex - 1);
                else if (diffX < 0 && currentIndex < navBtns.length - 1) switchTab(currentIndex + 1);
            }
        }

        function renderItinerary(dayId, btnElement) {
            if(btnElement) { document.querySelectorAll('.date-tab').forEach(t => t.classList.remove('active')); btnElement.classList.add('active'); }
            const container = document.getElementById('itinerary-content');
            const details = itineraryDetails[dayId];
            let html = `<div class="timeline-container">`;
            let dayTitle = ""; if(dayId === 'day1') dayTitle = "12/5 (äº”) ç®±æ ¹æº«æ³‰ä¹‹æ—…"; if(dayId === 'day2') dayTitle = "12/6 (å…­) æ©«é ˆè³€ & å…­æœ¬æœ¨"; if(dayId === 'day3') dayTitle = "12/7 (æ—¥) éŠ€æ & æ¾€è°·"; if(dayId === 'day4') dayTitle = "12/8 (ä¸€) æ·ºè‰ & éŠ€åº§"; if(dayId === 'day5') dayTitle = "12/9 (äºŒ) æ±äº¬è»Šç«™ & è¿”ç¨‹";
            html += `<h3 class="text-lg md:text-xl font-bold text-jp-gold mb-4 border-b border-jp-gold/30 pb-2">${dayTitle}</h3>`;
            details.forEach(item => {
                let recBadge = item.recommended ? `<div class="recommend-tag">âœ¨ ${item.recText || "æ¨è–¦"}</div>` : '';
                let diningHtml = '';
                if (item.diningOptions && item.diningOptions.length > 0) {
                    diningHtml += `<div class="dining-list"><div class="dining-header">ğŸ½ï¸ æ¨è–¦</div>`;
                    item.diningOptions.forEach(opt => {
                        let mapBadge = opt.inMap ? `<span class="in-map-badge">åœ°åœ–</span>` : '';
                        let linkIcon = opt.externalLink ? `<a href="${opt.externalLink}" target="_blank" class="text-blue-500 hover:text-blue-700 ml-1">ğŸ”—</a>` : '';
                        let priceTag = opt.price ? `<span class="text-[0.6rem] sm:text-xs text-gray-500 ml-1 sm:ml-2 bg-gray-100 px-1 rounded whitespace-nowrap">ğŸ’° ${opt.price}</span>` : '';
                        diningHtml += `<div class="dining-item"><div class="flex-grow"><span class="dining-name-link"><a href="${opt.mapUrl}" target="_blank" class="hover:text-jp-gold hover:underline flex items-center text-jp-brown">${opt.name}</a>${mapBadge}${linkIcon}${priceTag}</span><span class="dining-note">${opt.note}</span></div><span class="dining-rating">â˜…${opt.rating}</span></div>`;
                    });
                    diningHtml += `</div>`;
                }
                html += `<div class="detail-item"><div class="detail-time">${item.time}</div><div class="detail-title">${item.title}</div><div class="detail-desc">${item.desc}${recBadge}${diningHtml}</div></div>`;
            });
            html += `</div>`; container.innerHTML = html;
        }

        function updateMap(spotName) {
            const spot = spotsData.find(s => s.name === spotName); let query = spotName + " æ—¥æœ¬"; if (spot && spot.address) query = spot.address;
            mapFrame.src = `https://maps.google.com/maps?q=${encodeURIComponent(query)}&output=embed`;
            mapPlaceholder.style.display = 'none';
            document.querySelectorAll('.spot-item').forEach(el => { el.classList.remove('active-spot'); if (el.dataset.name === spotName) el.classList.add('active-spot'); });
        }

        function renderShoppingList() {
            if(!shoppingContainer) return;
            const categories = {}; shoppingList.forEach(item => { if(!categories[item.category]) categories[item.category] = []; categories[item.category].push(item); });
            let html = '';
            for (const [catName, items] of Object.entries(categories)) {
                html += `<div><h3 class="shop-category">${catName}</h3><div class="space-y-1">`;
                items.forEach((item, index) => {
                    let tagClass = ''; if(item.tag === 'Drugstore') tagClass = 'tag-drugstore'; if(item.tag === 'Variety') tagClass = 'tag-variety'; if(item.tag === 'Fashion') tagClass = 'tag-fashion'; if(item.tag === 'Contact') tagClass = 'tag-contact';
                    const uid = `shop-${catName}-${index}`; let imgLink = item.image ? `<a href="${item.image}" target="_blank" class="text-blue-500 ml-1 text-xs" title="æŸ¥çœ‹åœ–ç‰‡">ğŸ–¼ï¸ åœ–ç‰‡</a>` : ''; let extLink = item.externalLink ? `<a href="${item.externalLink}" target="_blank" class="text-blue-500 ml-1 text-xs" title="åº—é‹ªæŸ¥è©¢">ğŸ¬ åº—é‹ª</a>` : ''; let noteText = item.note ? `<div class="text-xs text-gray-500 mt-0.5">ğŸ’¡ ${item.note}</div>` : '';
                    html += `<div class="shop-item" onclick="toggleShopItem(this)"><input type="checkbox" class="mt-1 mr-2 cursor-pointer" id="${uid}"><div class="flex-grow"><div class="flex justify-between items-start"><span class="font-bold text-jp-brown text-xs shop-name flex items-center flex-wrap gap-1">${item.name}${imgLink}${extLink}</span><span class="shop-tag ${tagClass}">${item.tag}</span></div><div class="text-xs text-gray-500 mt-1">ğŸ“ ${item.location}</div>${noteText}</div></div>`;
                });
                html += `</div></div>`;
            }
            shoppingContainer.innerHTML = html;
        }

        window.toggleShopItem = (el) => {
            const checkbox = el.querySelector('input[type="checkbox"]');
            // If user clicked directly on a link (A tag), do nothing here (let the link work)
            if(event.target.tagName === 'A') return;
            
            if(event.target !== checkbox) checkbox.checked = !checkbox.checked;
            el.classList.toggle('checked', checkbox.checked);
        };

        window.closeModal = () => { document.getElementById('edit-modal').style.display = 'none'; };
        const flightModalEl = document.getElementById('flight-modal');
        window.openFlightModal = () => { flightModalEl.style.display = 'block'; };
        window.closeFlightModal = () => { flightModalEl.style.display = 'none'; };
        const accModalEl = document.getElementById('accommodation-modal');
        window.openAccommodationModal = () => { accModalEl.style.display = 'block'; };
        window.closeAccommodationModal = () => { accModalEl.style.display = 'none'; };
        window.closeDeleteModal = () => { document.getElementById('delete-modal').style.display = 'none'; };

        window.onclick = function(e) {
            if (e.target == document.getElementById('edit-modal')) closeModal();
            if (e.target == accModalEl) closeAccommodationModal();
            if (e.target == flightModalEl) closeFlightModal();
            if (e.target == document.getElementById('delete-modal')) closeDeleteModal();
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderSpotsList('all');
            renderShoppingList();
            renderItinerary('day1', document.querySelector('.date-tab'));
            updateMap('Tokyo Station');
            initApp(); 
            
            // è¨»å†Š Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('./service-worker.js')
                        .then(registration => {
                            console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        }, err => {
                            console.log('ServiceWorker registration failed: ', err);
                        });
                });
            }
        });
    </script>
</body>
</html>