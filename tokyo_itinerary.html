<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬ 5 æ—¥å®¢è£½åŒ–è¡Œç¨‹è¦åŠƒ (2025/12/5-12/9)</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts (æ—¥å¼å„ªé›…è¥¯ç·šé«”) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Zen+Old+Mincho:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'jp-gold': '#D4AF37', /* éŠ€æé‡‘ */
                        'jp-gold-light': '#F3E5AB',
                        'jp-brown': '#594a4e', /* å‚³çµ±æ·±è¤ */
                        'jp-red': '#C0392B',    /* é»ç¶´ç´… (é³¥å±…è‰²) */
                        'jp-cream': '#FDFCF5', /* å’Œç´™ç™½ */
                    },
                    fontFamily: {
                        sans: ['Zen Old Mincho', 'Noto Serif TC', 'serif'],
                        serif: ['Zen Old Mincho', 'Noto Serif TC', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        body {
            background-color: #FDFCF5; /* å’Œç´™ç™½èƒŒæ™¯ */
            background-image: radial-gradient(#D4AF37 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            color: #594a4e;
            overflow-x: hidden; /* é˜²æ­¢æ»‘å‹•æ™‚é é¢æ™ƒå‹• */
        }

        /* éš±è—æ²è»¸ä½†ä¿ç•™åŠŸèƒ½ (Chrome/Safari/Webkit) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* éš±è—æ²è»¸ (IE/Edge/Firefox) */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* å„ªé›…æŒ‰éˆ•æ¨£å¼ (ç¸®å°ç‰ˆ) */
        .nav-btn {
            position: relative;
            padding: 0.35rem 1rem; /* ç¸®å° Padding */
            margin-right: 0.25rem;
            font-size: 0.85rem;    /* ç¸®å°å­—é«” */
            font-weight: 600;
            color: #594a4e;
            border: 1px solid #D4AF37;
            border-radius: 9999px; /* Pill shape */
            transition: all 0.3s ease;
            background-color: white;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
            flex-shrink: 0; /* é˜²æ­¢æŒ‰éˆ•è¢«å£“ç¸® */
        }
        .nav-btn:hover, .nav-btn.active {
            background-color: #D4AF37;
            color: white;
            box-shadow: 0 2px 4px -1px rgba(212, 175, 55, 0.3);
            transform: translateY(-1px);
        }

        /* å…§å®¹å€å¡Š */
        .content-section { display: none; }
        .content-section.active { 
            display: block; 
            animation: fadeIn 0.3s ease-out; /* åŠ å¿«å‹•ç•«é€Ÿåº¦é…åˆæ»‘å‹• */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ—¥æœŸé¸å–®æ¨£å¼å„ªåŒ– (å·¦å´ç›´æ¢) */
        .date-tab {
            display: block;
            width: 100%;
            text-align: center; /* æ‰‹æ©Ÿç‰ˆç½®ä¸­ */
            padding: 0.75rem 0.25rem;
            border-right: 3px solid transparent; /* å³å´é‚Šæ¡†æ¨™ç¤º (Mobile) */
            border-left: 0;
            border-bottom: 1px solid #e5e7eb;
            color: #594a4e;
            transition: all 0.3s;
            font-family: 'Zen Old Mincho', serif;
        }
        @media (min-width: 768px) {
            .date-tab {
                text-align: left;
                padding: 1rem 1.5rem;
                border-right: 0;
                border-left: 4px solid transparent; /* é›»è…¦ç‰ˆç¶­æŒå·¦å´é‚Šæ¡† */
                border-bottom: 0;
            }
        }
        
        .date-tab:hover {
            background-color: rgba(212, 175, 55, 0.1);
        }
        .date-tab.active {
            background-color: white;
            font-weight: bold;
        }
        
        /* Mobile Active Style */
        @media (max-width: 767px) {
            .date-tab.active {
                border-right-color: #D4AF37;
                background-color: #fff;
            }
        }
        /* Desktop Active Style */
        @media (min-width: 768px) {
            .date-tab.active {
                border-left-color: #D4AF37;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            }
        }

        .date-tab .day-num { font-size: 1rem; display: block; font-weight: bold; }
        .date-tab .day-week { font-size: 0.7rem; opacity: 0.8; display: block; margin-top: 2px; }
        
        @media (min-width: 768px) {
            .date-tab .day-num { font-size: 1.25rem; }
            .date-tab .day-week { font-size: 0.875rem; }
        }

        /* è©³ç´°è¡Œç¨‹æ™‚é–“è»¸ (é–“è·ç¸®çŸ­) */
        .timeline-container {
            position: relative;
            padding-left: 1rem; /* ç¸®å°å…§ç¸® */
        }
        @media (min-width: 768px) {
            .timeline-container { padding-left: 2rem; }
        }
        .detail-item {
            position: relative;
            padding-bottom: 1.5rem; /* å¤§å¹…ç¸®çŸ­é–“è· */
            border-left: 1px solid #D4AF37;
            padding-left: 1.25rem;
        }
        .detail-item:last-child { border-left: transparent; }
        .detail-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0;
            width: 11px;
            height: 11px;
            background-color: #FDFCF5;
            border: 2px solid #D4AF37;
            border-radius: 50%;
        }
        .detail-time {
            font-family: 'Noto Serif TC', serif;
            color: #D4AF37;
            font-weight: bold;
            margin-bottom: 0.1rem;
            font-size: 0.85rem;
        }
        .detail-title {
            font-size: 1rem;
            font-weight: bold;
            color: #594a4e;
            margin-bottom: 0.25rem;
        }
        .detail-desc {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.5;
            background-color: rgba(243, 229, 171, 0.15); 
            padding: 0.5rem; /* ç¸®å°å…§è· */
            border-radius: 0.5rem;
        }
        .recommend-tag {
            display: inline-block;
            margin-top: 0.25rem;
            background-color: #FCE7F3; 
            color: #9D174D;
            font-size: 0.7rem;
            padding: 1px 6px;
            border-radius: 4px;
            border: 1px solid #FBCFE8;
        }

        /* é¤å»³æ¨è–¦åˆ—è¡¨æ¨£å¼ */
        .dining-list {
            margin-top: 0.5rem;
            background-color: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.4rem;
        }
        .dining-header {
            font-size: 0.7rem;
            font-weight: bold;
            color: #D4AF37;
            margin-bottom: 0.25rem;
            border-bottom: 1px solid #f3f4f6;
            padding-bottom: 0.2rem;
        }
        .dining-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.25rem 0;
            border-bottom: 1px dashed #f3f4f6;
        }
        .dining-item:last-child { border-bottom: none; }
        .dining-name-link {
            font-weight: bold;
            color: #594a4e;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            text-decoration: none;
            transition: color 0.2s;
        }
        .dining-name-link:hover {
            color: #D4AF37;
            text-decoration: underline;
        }
        .dining-note {
            font-size: 0.7rem;
            color: #666;
            display: block;
            margin-top: 1px;
        }
        .dining-rating {
            font-size: 0.7rem;
            color: #d97706; /* Amber-600 */
            background-color: #fef3c7;
            padding: 1px 4px;
            border-radius: 3px;
            white-space: nowrap;
            margin-left: 0.5rem;
            flex-shrink: 0;
        }
        .in-map-badge {
            font-size: 0.6rem;
            background-color: #dbeafe;
            color: #1e40af;
            padding: 0 3px;
            border-radius: 2px;
            margin-left: 3px;
            white-space: nowrap;
        }

        /* è³¼ç‰©æ¸…å–®æ¨£å¼ */
        .shop-category {
            font-weight: bold;
            color: #D4AF37;
            font-size: 1rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #F3E5AB;
            padding-bottom: 0.25rem;
        }
        .shop-item {
            display: flex;
            align-items: flex-start;
            padding: 0.6rem;
            background: white;
            border: 1px solid #f3f4f6;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }
        .shop-item:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-color: #D4AF37;
        }
        .shop-item.checked {
            opacity: 0.6;
            background-color: #f9fafb;
        }
        .shop-item.checked .shop-name {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .shop-tag {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: auto;
            white-space: nowrap;
            font-weight: bold;
        }
        .tag-drugstore { background-color: #fee2e2; color: #b91c1c; } /* Red for Drugstore */
        .tag-variety { background-color: #fef3c7; color: #d97706; } /* Yellow for Loft/3coins */
        .tag-fashion { background-color: #e0e7ff; color: #4338ca; } /* Blue for Fashion */
        .tag-contact { background-color: #fce7f3; color: #be185d; } /* Pink for Contact Lens */

        /* æ¨¡æ…‹æ¡†æ¨£å¼ */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 100; 
            left: 0; top: 0;
            width: 100%; height: 100%; 
            overflow: auto; 
            background-color: rgba(89, 74, 78, 0.6); 
            backdrop-filter: blur(2px);
        }
        .modal-content {
            background-color: #FDFCF5;
            margin: 10% auto;
            padding: 1.5rem;
            border: 1px solid #D4AF37;
            width: 90%; 
            max-width: 500px;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* åˆ†é¡æ¨™ç±¤æ¨£å¼ */
        .badge {
            display: inline-block;
            padding: 2px 8px;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid currentColor;
        }
        .filter-btn.active {
            background-color: #594a4e;
            color: #FDFCF5;
            border-color: #594a4e;
        }

        /* åˆ—è¡¨é …ç›®äº’å‹•æ¨£å¼ */
        .spot-item {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border-left: 4px solid transparent;
        }
        .spot-item:hover {
            background-color: rgba(243, 229, 171, 0.3);
        }
        .spot-item.active-spot {
            background-color: rgba(212, 175, 55, 0.15);
            border-left-color: #D4AF37;
        }
        
        /* Loading ç‹€æ…‹ */
        .loading-text {
            color: #D4AF37;
            font-size: 0.8rem;
            text-align: center;
            padding: 1rem;
        }
    </style>
</head>
<body class="font-serif">

    <!-- é ‚éƒ¨å°è¦½åˆ— (é«˜åº¦ç¸®å°) -->
    <nav class="sticky top-0 z-50 bg-jp-cream/95 backdrop-blur-md shadow-sm border-b border-jp-gold/20">
        <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8">
            <div class="flex flex-col items-center justify-center py-2"> <!-- Padding reduced -->
                <div class="mb-2">
                    <!-- Title font size reduced -->
                    <h1 class="text-xl sm:text-2xl font-bold text-jp-brown tracking-widest border-b-2 border-jp-gold pb-1 px-4">TOKYO TRIP</h1>
                </div>
                <!-- æ‰‹æ©Ÿç‰ˆå°è¦½åˆ— -->
                <div id="navbar-scroll-container" class="flex flex-nowrap justify-start sm:justify-center gap-1 w-full overflow-x-auto no-scrollbar px-1 pb-1 scroll-smooth">
                    <button class="nav-btn active" data-section="checklist">è¡Œå‰æº–å‚™</button>
                    <button class="nav-btn" data-section="transport">äº¤é€šä½å®¿</button>
                    <button class="nav-btn" data-section="daily-itinerary">æ¯æ—¥è¡Œç¨‹</button>
                    <button class="nav-btn" data-section="map-list">æ—…ç¨‹åœ°åœ–</button>
                    <button class="nav-btn" data-section="shopping-list">è³¼ç‰©æ¸…å–®</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ (Swipe Listener Area) -->
    <main id="main-content" class="max-w-6xl mx-auto py-2 px-2 sm:px-6 lg:px-8 min-h-screen">

        <!-- 1. è¡Œå‰æº–å‚™ -->
        <section id="checklist" class="content-section active bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 md:mb-8 flex items-center justify-center">
                <span class="text-jp-gold mr-3">âœ¦</span> è¡Œå‰æº–å‚™ <span class="text-jp-gold ml-3">âœ¦</span>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8">
                <!-- é å…ˆè³¼è²· -->
                <div class="bg-jp-gold-light/10 p-4 rounded-lg border border-jp-gold/20">
                    <h3 class="text-base font-bold text-jp-red mb-3 flex items-center">
                        âš ï¸ å‹™å¿…é å…ˆé ç´„ / æ¶ç¥¨
                    </h3>
                    <ul class="space-y-2 text-sm text-jp-brown list-disc list-inside">
                        <li><strong>SHIBUYA SKYï¼š</strong> 12/7 æ—¥è½å ´æ¬¡ (ç´„ 16:00-16:20)ã€‚</li>
                        <li><strong>è»æ¸¯å·¡èˆªï¼š</strong> 12/6 12:00 èˆ¹ç­ã€‚</li>
                        <li><strong>æ°´ä¸Šå·´å£«ï¼š</strong> 12/8 æ·ºè‰ â†’ æµœé›¢å®®ã€‚</li>
                        <li><strong>ç“”ç (åˆé¤)ï¼š</strong> 12/5 12:15 (å·²è¨‚ä½)ã€‚</li>
                        <li><strong>äº¤é€šåˆ¸ï¼š</strong> N'EXã€å°ç”°æ€¥ã€Subway Ticketã€‚</li>
                    </ul>
                </div>
                
                <!-- è¡Œææ¸…å–® -->
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <h3 class="text-base font-bold text-jp-brown">è¡Œææ¸…å–®</h3>
                            <span id="sync-status" class="text-[0.6rem] text-jp-gold border border-jp-gold px-1 rounded">é›²ç«¯åŒæ­¥ä¸­</span>
                        </div>
                        <div class="text-xs text-gray-500">å¯é»æ“Šç·¨è¼¯</div>
                    </div>
                    
                    <div class="mb-4 bg-gray-50 p-2 rounded border border-gray-100 flex flex-col gap-2">
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input id="new-item-input" type="text" placeholder="ç‰©å“åç¨±" class="w-full sm:flex-grow p-2 border rounded text-sm focus:outline-none focus:border-jp-gold">
                            <select id="new-item-category" class="w-full sm:w-auto p-2 border rounded text-sm bg-white">
                                <option value="é›œç‰©">é›œç‰©</option>
                                <option value="3C">3C</option>
                                <option value="è¡£ç‰©">è¡£ç‰©</option>
                                <option value="åŒ–å¦ã€ä¿é¤Š">ä¿é¤Š</option>
                                <option value="é‡è¦">é‡è¦</option>
                            </select>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <select id="new-item-location" class="w-full sm:w-1/3 p-2 border rounded text-sm bg-white">
                                <option value="å¤§ç®±">å¤§ç®±</option>
                                <option value="ç™»æ©Ÿç®±">ç™»æ©Ÿç®±</option>
                                <option value="éš¨èº«åŒ…">éš¨èº«</option>
                            </select>
                            <input id="new-item-note" type="text" placeholder="å‚™è¨» (é¸å¡«)" class="w-full sm:flex-grow p-2 border rounded text-sm">
                            <button id="add-item-btn" class="w-full sm:w-auto bg-jp-gold text-white px-4 py-2 sm:py-1 rounded text-sm hover:bg-yellow-600 transition font-bold disabled:opacity-50">æ–°å¢</button>
                        </div>
                    </div>

                    <div id="luggage-list-container" class="space-y-1 max-h-[400px] overflow-y-auto pr-1">
                        <div class="loading-text">è¼‰å…¥æ¸…å–®ä¸­...</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. äº¤é€šä½å®¿ -->
        <section id="transport" class="content-section bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 md:mb-8 flex items-center justify-center">
                <span class="text-jp-gold mr-3">âœ¦</span> äº¤é€šèˆ‡ä½å®¿ <span class="text-jp-gold ml-3">âœ¦</span>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8">
                <!-- ä½å®¿è³‡è¨Š -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-jp-brown border-l-4 border-jp-gold pl-2">ä½å®¿åœ°é»</h3>
                    
                    <div class="bg-jp-gold-light/20 p-4 rounded-lg border border-jp-gold/30 hover:shadow-md transition">
                        <h4 class="font-bold text-base mb-1 text-jp-brown">ç®±æ ¹ï¼šHakone Pax Yoshino</h4>
                        <div class="text-sm space-y-1 opacity-90">
                            <p>ğŸ“… å…¥ä½ï¼š12/5 (é€±äº”)</p>
                            <p>ğŸ’° è²»ç”¨ï¼šNT$5,933</p>
                            <p class="text-jp-gold font-medium mt-1">â™¨ï¸ å«æº«æ³‰è¨­æ–½ï¼Œè¿‘ç®±æ ¹æ¹¯æœ¬ç«™ã€‚</p>
                        </div>
                    </div>

                    <!-- æ±äº¬ä½å®¿ï¼šç§‹è‘‰è‹‘ -->
                    <div class="bg-jp-gold-light/20 p-4 rounded-lg border border-jp-red/30 hover:shadow-md transition relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-jp-red text-white text-xs px-2 py-1 rounded-bl">é‡è¦</div>
                        <h4 class="font-bold text-base mb-1 text-jp-brown">æ±äº¬ï¼šç§‹è‘‰è‹‘</h4>
                        <div class="text-sm space-y-1 opacity-90">
                            <p>ğŸ“… å…¥ä½ï¼š12/6 - 12/8 (ä¸‰æ™š)</p>
                            <p>ğŸ“ åœ°å€ï¼šåƒä»£ç”°åŒºå¤–ç¥ç”°ä¸‰ä¸ç›®8-8</p>
                            <p>ğŸ“ é›»è©±ï¼š070-8333-3174</p>
                        </div>
                        <button onclick="openAccommodationModal()" class="mt-3 w-full border border-jp-red text-jp-red hover:bg-jp-red hover:text-white font-bold py-1.5 px-4 rounded transition duration-300 text-sm flex items-center justify-center">
                            <span class="mr-2">âš ï¸</span> æŸ¥çœ‹å…¥ä½é ˆçŸ¥ & è­¦å‘Š
                        </button>
                    </div>
                </div>

                <!-- äº¤é€šè³‡è¨Š -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-jp-brown border-l-4 border-jp-gold pl-2">èˆªç­è³‡è¨Š</h3>
                    
                    <div onclick="openFlightModal()" class="cursor-pointer group bg-white p-4 rounded-lg border border-jp-gold/30 shadow-sm hover:shadow-md hover:border-jp-gold transition-all duration-300 relative overflow-hidden">
                        <div class="absolute top-0 right-0 bg-jp-gold text-white text-xs px-2 py-1 rounded-bl-lg font-bold">é»æ“ŠæŸ¥çœ‹è©³æƒ…</div>
                        <div class="flex flex-col gap-3">
                            <div class="flex items-center gap-3">
                                <div class="bg-jp-gold/10 p-2 rounded-full text-xl">âœˆï¸</div>
                                <div>
                                    <h4 class="text-base font-bold text-jp-brown">å°åŒ— â‡Œ æ±äº¬</h4>
                                    <p class="text-xs text-gray-500">2025/12/5 - 12/9</p>
                                </div>
                            </div>
                            <div class="flex gap-2 text-xs text-gray-600">
                                <span class="bg-gray-100 px-2 py-1 rounded flex items-center gap-1">
                                    <span class="text-jp-red font-bold">å»</span> GK012
                                </span>
                                <span class="bg-gray-100 px-2 py-1 rounded flex items-center gap-1">
                                    <span class="text-jp-brown font-bold">å›</span> TR875
                                </span>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-bold text-jp-brown border-l-4 border-jp-gold pl-2">äº¤é€šç¥¨åˆ¸</h3>
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-sm leading-relaxed">
                        <ul class="space-y-2 list-disc list-outside ml-4 text-jp-brown">
                            <li><span class="font-bold">N'EX æˆç”°ç‰¹å¿«</span>ï¼šæ©Ÿå ´å¾€è¿”ã€‚</li>
                            <li><span class="font-bold">ç®±æ ¹å‘¨éŠåˆ¸</span> + æµªæ¼«ç‰¹å¿«ç‰¹æ€¥è²»ã€‚</li>
                            <li><span class="font-bold">Subway Ticket (3æ—¥)</span>ï¼š12/7~12/9ã€‚</li>
                            <li><span class="font-bold">è¥¿ç“œå¡ (Suica)</span>ï¼šè¼”åŠ©ç”¨ã€‚</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. æ¯æ—¥è¡Œç¨‹ (Modified Layout: Sidebar Left) -->
        <section id="daily-itinerary" class="content-section bg-white rounded-2xl shadow-lg border border-jp-gold/20 overflow-hidden">
            <!-- 
                Change: Always flex-row, Left Sidebar for Dates
            -->
            <div class="flex flex-row h-[85vh] md:h-[650px]">
                
                <!-- æ—¥æœŸé¸å–® (å›ºå®šåœ¨å·¦å´) -->
                <div class="w-20 md:w-1/4 bg-gray-50 border-r border-gray-200 flex flex-col overflow-y-auto no-scrollbar flex-shrink-0 z-10">
                    <button class="date-tab active" onclick="renderItinerary('day1', this)">
                        <span class="day-num">12/5</span>
                        <span class="day-week">é€±äº”</span>
                    </button>
                    <button class="date-tab" onclick="renderItinerary('day2', this)">
                        <span class="day-num">12/6</span>
                        <span class="day-week">é€±å…­</span>
                    </button>
                    <button class="date-tab" onclick="renderItinerary('day3', this)">
                        <span class="day-num">12/7</span>
                        <span class="day-week">é€±æ—¥</span>
                    </button>
                    <button class="date-tab" onclick="renderItinerary('day4', this)">
                        <span class="day-num">12/8</span>
                        <span class="day-week">é€±ä¸€</span>
                    </button>
                    <button class="date-tab" onclick="renderItinerary('day5', this)">
                        <span class="day-num">12/9</span>
                        <span class="day-week">é€±äºŒ</span>
                    </button>
                </div>

                <!-- è¡Œç¨‹å…§å®¹ -->
                <div class="flex-1 bg-white overflow-y-auto h-full p-3 md:p-8 relative scroll-smooth">
                    <div id="itinerary-content">
                        <!-- Content will be injected by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. æ—…ç¨‹åœ°åœ– -->
        <section id="map-list" class="content-section bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 flex items-center justify-center">
                <span class="text-jp-gold mr-3">âœ¦</span> æ—…ç¨‹åœ°åœ– <span class="text-jp-gold ml-3">âœ¦</span>
            </h2>

            <!-- ç¯©é¸å™¨ -->
            <div class="flex flex-wrap justify-center gap-2 mb-4">
                <button class="filter-btn active px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="food">ç¾é£Ÿ</button>
                <button class="filter-btn px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="shopping">è³¼ç‰©</button>
                <button class="filter-btn px-3 py-1 rounded border border-jp-brown text-jp-brown hover:bg-jp-brown hover:text-white transition text-xs md:text-sm font-medium" data-filter="sightseeing">æ™¯é»</button>
            </div>

            <div class="flex flex-col md:flex-row gap-4 h-[85vh] md:h-[600px]">
                <div class="w-full md:w-3/5 h-2/5 md:h-full rounded-xl overflow-hidden shadow-md border border-gray-300 relative bg-gray-100 shrink-0">
                    <iframe id="map-frame" class="w-full h-full border-0" loading="lazy" allowfullscreen src=""></iframe>
                    <div id="map-placeholder" class="absolute inset-0 flex items-center justify-center bg-gray-100 text-gray-500 text-sm p-4 text-center">
                        è«‹é»æ“Šåœ°é»ä»¥é¡¯ç¤ºåœ°åœ–
                    </div>
                </div>
                <div class="w-full md:w-2/5 h-3/5 md:h-full overflow-y-auto pr-1 space-y-2" id="spots-list-container"></div>
            </div>
        </section>

        <!-- 5. è³¼ç‰©æ¸…å–® -->
        <section id="shopping-list" class="content-section bg-white p-4 md:p-8 rounded-2xl shadow-lg border border-jp-gold/20">
            <h2 class="text-xl font-bold text-jp-brown mb-4 flex items-center justify-center">
                <span class="text-jp-gold mr-3">âœ¦</span> è²·è²·è²·æ¸…å–® <span class="text-jp-gold ml-3">âœ¦</span>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="shopping-list-container"></div>
        </section>

    </main>

    <!-- Modals (ç·¨è¼¯ & ä½å®¿é ˆçŸ¥ & åˆªé™¤ç¢ºèª) -->
    
    <!-- 1. ç·¨è¼¯ç‰©å“ Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-lg font-bold mb-4 text-jp-brown">ç·¨è¼¯ç‰©å“</h3>
            <div class="space-y-3">
                <input id="edit-item-name" class="w-full p-2 border rounded text-sm" placeholder="åç¨±">
                <div class="flex gap-2">
                    <select id="edit-item-category" class="w-1/2 p-2 border rounded text-sm bg-white"></select>
                    <select id="edit-item-location" class="w-1/2 p-2 border rounded text-sm bg-white"></select>
                </div>
                <input id="edit-item-note" class="w-full p-2 border rounded text-sm" placeholder="å‚™è¨»">
                <div class="flex justify-end gap-2 mt-4">
                    <button onclick="closeModal()" class="px-3 py-1.5 text-sm bg-gray-200 rounded">å–æ¶ˆ</button>
                    <button onclick="saveEdit()" class="px-3 py-1.5 text-sm bg-jp-gold text-white rounded">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šåˆªé™¤ç¢ºèª Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content !max-w-sm text-center">
            <h3 class="text-lg font-bold mb-4 text-jp-brown">ç¢ºå®šåˆªé™¤æ­¤ç‰©å“ï¼Ÿ</h3>
            <p class="text-sm text-gray-500 mb-6">æ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚</p>
            <div class="flex justify-center gap-4">
                <button onclick="closeDeleteModal()" class="px-3 py-1.5 text-sm bg-gray-200 rounded hover:bg-gray-300">å–æ¶ˆ</button>
                <button onclick="confirmDelete()" class="px-3 py-1.5 text-sm bg-jp-red text-white rounded hover:bg-red-700">ç¢ºå®šåˆªé™¤</button>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ï¼šèˆªç­è©³ç´°è³‡è¨Š Modal -->
    <div id="flight-modal" class="modal">
        <div class="modal-content !max-w-2xl">
            <div class="flex justify-between items-center mb-4 border-b border-jp-gold/20 pb-2">
                <div>
                    <h3 class="text-lg font-bold text-jp-brown">èˆªç­è©³ç´°è³‡è¨Š</h3>
                    <p class="text-xs text-gray-500 mt-1">è¨‚å–®ç·¨è™Ÿï¼š1616326399870957</p>
                </div>
                <button onclick="closeFlightModal()" class="text-gray-400 hover:text-gray-600 text-xl">Ã—</button>
            </div>
            <div class="space-y-4 overflow-y-auto max-h-[60vh] pr-2">
                <!-- å»ç¨‹ -->
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <span class="bg-jp-red text-white text-xs px-2 py-1 rounded font-bold">å»ç¨‹</span>
                        <span class="text-sm font-bold text-jp-brown">GK012</span>
                    </div>
                    <div class="flex justify-between items-center mb-2 text-center">
                        <div><div class="text-xl font-bold text-jp-brown font-serif">02:30</div><div class="text-xs text-gray-500">TPE T1</div></div>
                        <div class="text-gray-300 text-xs">â”€â”€âœˆâ”€â”€</div>
                        <div><div class="text-xl font-bold text-jp-brown font-serif">06:35</div><div class="text-xs text-gray-500">NRT T3</div></div>
                    </div>
                </div>
                <!-- å›ç¨‹ -->
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                    <div class="flex justify-between items-center mb-2">
                        <span class="bg-jp-brown text-white text-xs px-2 py-1 rounded font-bold">å›ç¨‹</span>
                        <span class="text-sm font-bold text-jp-brown">TR875</span>
                    </div>
                    <div class="flex justify-between items-center mb-2 text-center">
                        <div><div class="text-xl font-bold text-jp-brown font-serif">19:55</div><div class="text-xs text-gray-500">NRT T1</div></div>
                        <div class="text-gray-300 text-xs">â”€â”€âœˆâ”€â”€</div>
                        <div><div class="text-xl font-bold text-jp-brown font-serif">23:10</div><div class="text-xs text-gray-500">TPE T1</div></div>
                    </div>
                </div>
            </div>
            <button onclick="closeFlightModal()" class="w-full mt-4 bg-jp-brown text-white py-2 rounded hover:bg-gray-700 transition">é—œé–‰</button>
        </div>
    </div>

    <!-- 2. ä½å®¿é ˆçŸ¥ Modal -->
    <div id="accommodation-modal" class="modal">
        <div class="modal-content border-t-4 border-jp-red">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-jp-brown">ç§‹è‘‰è‹‘ - å…¥ä½é ˆçŸ¥</h3>
                <button onclick="closeAccommodationModal()" class="text-gray-400 hover:text-gray-600">âœ•</button>
            </div>
            <div class="bg-red-50 p-3 rounded border border-red-100 mb-3">
                <p class="font-bold text-jp-red mb-1 text-base">âš ï¸ åš´é‡è­¦å‘Š</p>
                <ul class="list-decimal list-inside text-xs text-red-800 space-y-1 font-bold">
                    <li>å±‹å…§åš´ç¦å¸è¸ã€‚</li>
                    <li>åƒä»£ç”°å€åƒåœ¾åˆ†é¡æ¥µåš´æ ¼ã€‚</li>
                </ul>
            </div>
            <div class="space-y-2 text-sm text-gray-700">
                <p><strong>ğŸ•’ å…¥ä½ï¼š</strong> 16:00 å¾Œ</p>
                <p><strong>ğŸ§³ å¯„å­˜ï¼š</strong> 10:00 å¾Œ</p>
                <p><strong>ğŸ”‘ é€€æˆ¿ï¼š</strong> 10:00 å‰</p>
            </div>
            <button onclick="closeAccommodationModal()" class="w-full mt-4 bg-jp-brown text-white py-2 rounded hover:bg-gray-700 transition">æˆ‘å·²äº†è§£</button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query as firestoreQuery } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global Variables for App Logic
        let user = null;
        let luggageItems = []; 
        let currentEditId = null;
        let itemToDeleteId = null;
        
        // Firestore Collection Reference (Public Data for Sharing)
        const collectionPath = `artifacts/${appId}/public/data/luggage_list`;
        
        /* ---------------- Firebase Logic ---------------- */
        
        // 1. Authentication & Listener Setup
        async function initApp() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth Error:", error);
            }

            onAuthStateChanged(auth, (u) => {
                user = u;
                if (user) {
                    setupRealtimeListener();
                    // Enable button visually when ready
                    const btn = document.getElementById('add-item-btn');
                    if(btn) btn.disabled = false;
                }
            });
        }

        function setupRealtimeListener() {
            if (!user) return;
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'luggage_list');
            
            // Listen for changes
            onSnapshot(colRef, (snapshot) => {
                luggageItems = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                renderLuggage();
                const statusEl = document.getElementById('sync-status');
                if(statusEl) {
                    statusEl.textContent = "å·²åŒæ­¥";
                    setTimeout(() => statusEl.textContent = "é›²ç«¯åŒæ­¥ä¸­", 3000);
                }
            }, (error) => {
                console.error("Firestore Error:", error);
                const container = document.getElementById('luggage-list-container');
                if(container) container.innerHTML = `<div class="text-red-500 text-center text-sm p-4">ç„¡æ³•è¼‰å…¥æ¸…å–®ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</div>`;
            });
        }

        // 2. CRUD Operations
        
        // Add Item (Defined locally first to avoid reference errors)
        const addItemToFirestore = async () => {
            if (!user) {
                alert("ç³»çµ±é€£ç·šä¸­ï¼Œè«‹ç¨å€™å†è©¦..."); 
                return;
            }
            const nameInput = document.getElementById('new-item-input');
            const catInput = document.getElementById('new-item-category');
            const locInput = document.getElementById('new-item-location');
            const noteInput = document.getElementById('new-item-note');
            const btn = document.getElementById('add-item-btn');

            const name = nameInput.value.trim();
            if (!name) return;

            btn.disabled = true; // Prevent double click
            btn.textContent = "...";

            try {
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'luggage_list');
                await addDoc(colRef, {
                    item: name,
                    category: catInput.value,
                    location: locInput.value,
                    note: noteInput.value,
                    checked: false,
                    createdAt: new Date().toISOString() // optional sorting aid
                });
                
                // Reset UI
                nameInput.value = '';
                noteInput.value = '';
            } catch (e) {
                console.error("Add Error:", e);
                alert("æ–°å¢å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š");
            } finally {
                btn.disabled = false;
                btn.textContent = "æ–°å¢";
            }
        };

        // Toggle Checkbox
        const toggleCheck = async (docId, currentStatus) => {
            if (!user) return;
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'luggage_list', docId);
                await updateDoc(docRef, { checked: !currentStatus });
            } catch (e) {
                console.error("Toggle Error:", e);
            }
        };

        // Open Edit Modal
        const openEdit = (docId) => {
            currentEditId = docId;
            const item = luggageItems.find(i => i.id === docId);
            if (!item) return;

            document.getElementById('edit-item-name').value = item.item;
            document.getElementById('edit-item-note').value = item.note || '';
            
            const cats = ['é›œç‰©','3C','è¡£ç‰©','åŒ–å¦ã€ä¿é¤Š','é‡è¦'];
            const locs = ['å¤§ç®±','ç™»æ©Ÿç®±','éš¨èº«åŒ…'];
            
            const catSelect = document.getElementById('edit-item-category');
            catSelect.innerHTML = cats.map(c => `<option value="${c}" ${c===item.category?'selected':''}>${c}</option>`).join('');
            
            const locSelect = document.getElementById('edit-item-location');
            locSelect.innerHTML = locs.map(l => `<option value="${l}" ${l===item.location?'selected':''}>${l}</option>`).join('');
            
            document.getElementById('edit-modal').style.display = 'block';
        };

        // Save Edit
        const saveEdit = async () => {
            if (!user || !currentEditId) return;
            
            const newName = document.getElementById('edit-item-name').value;
            const newCat = document.getElementById('edit-item-category').value;
            const newLoc = document.getElementById('edit-item-location').value;
            const newNote = document.getElementById('edit-item-note').value;

            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'luggage_list', currentEditId);
                await updateDoc(docRef, {
                    item: newName,
                    category: newCat,
                    location: newLoc,
                    note: newNote
                });
                window.closeModal(); // Use window.closeModal defined in the other script
            } catch (e) {
                console.error("Update Error:", e);
                alert("æ›´æ–°å¤±æ•—");
            }
        };

        // Delete Logic
        const openDelete = (docId) => {
            itemToDeleteId = docId;
            document.getElementById('delete-modal').style.display = 'block';
        };

        const confirmDelete = async () => {
            if (!user || !itemToDeleteId) return;
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'luggage_list', itemToDeleteId);
                await deleteDoc(docRef);
                closeDeleteModal();
            } catch (e) {
                console.error("Delete Error:", e);
                alert("åˆªé™¤å¤±æ•—");
            }
        };

        const closeDeleteModal = () => {
            itemToDeleteId = null;
            document.getElementById('delete-modal').style.display = 'none';
        };

        // UI Renders
        function renderLuggage() {
            const container = document.getElementById('luggage-list-container');
            if(!container) return;
            container.innerHTML = '';
            
            if (luggageItems.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 text-sm p-4">ç›®å‰æ²’æœ‰ç‰©å“ï¼Œè«‹æ–°å¢ã€‚</div>';
                return;
            }

            // Sort: Location -> Category -> Checked
            const sorted = [...luggageItems].sort((a, b) => {
                if(a.location !== b.location) return a.location.localeCompare(b.location, "zh-TW");
                if(a.category !== b.category) return a.category.localeCompare(b.category, "zh-TW");
                return a.checked - b.checked;
            });

            sorted.forEach(item => {
                const badgeColor = item.category === 'é‡è¦' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-600';
                let locColor = 'bg-gray-100 text-gray-800';
                if (item.location === 'å¤§ç®±') locColor = 'bg-blue-100 text-blue-800 border border-blue-200';
                else if (item.location === 'ç™»æ©Ÿç®±') locColor = 'bg-green-100 text-green-800 border border-green-200';
                else if (item.location === 'éš¨èº«åŒ…') locColor = 'bg-yellow-100 text-yellow-800 border border-yellow-200';

                // NOTE: Use quotes for string IDs in onclick
                container.innerHTML += `
                    <div class="flex items-start p-2 bg-gray-50 rounded border border-gray-100 hover:bg-white transition ${item.checked ? 'opacity-50' : ''}">
                        <input type="checkbox" class="mt-1 mr-2 cursor-pointer" ${item.checked ? 'checked' : ''} onchange="toggleCheck('${item.id}', ${item.checked})">
                        <div class="flex-grow">
                            <div class="flex gap-1 mb-1">
                                <span class="text-xs px-1.5 rounded ${locColor}">${item.location}</span>
                                <span class="text-xs px-1.5 rounded ${badgeColor}">${item.category}</span>
                            </div>
                            <div class="font-medium text-sm text-jp-brown ${item.checked ? 'line-through' : ''}">${item.item}</div>
                            ${item.note ? `<div class="text-xs text-gray-500 mt-0.5">ğŸ“ ${item.note}</div>` : ''}
                        </div>
                        <button onclick="openEdit('${item.id}')" class="text-blue-400 hover:text-blue-600 mx-1">âœï¸</button>
                        <button onclick="openDelete('${item.id}')" class="text-red-400 hover:text-red-600 mx-1">ğŸ—‘ï¸</button>
                    </div>
                `;
            });
        }

        // Export functions to window for HTML event handlers
        window.addItemToFirestore = addItemToFirestore;
        window.toggleCheck = toggleCheck;
        window.openEdit = openEdit;
        window.saveEdit = saveEdit;
        window.openDelete = openDelete;
        window.confirmDelete = confirmDelete;
        window.closeDeleteModal = closeDeleteModal;

        // Event Listeners
        const addBtn = document.getElementById('add-item-btn');
        if(addBtn) {
            addBtn.addEventListener('click', addItemToFirestore);
        }

        // Init
        initApp();
        
    </script>
    <script>
        /* ---------------- åŸæœ‰éœæ…‹åŠŸèƒ½ (é Firebase éƒ¨åˆ†) ---------------- */
        
        // Modals Logic (Helpers)
        window.closeModal = () => { document.getElementById('edit-modal').style.display = 'none'; };
        const flightModal = document.getElementById('flight-modal');
        window.openFlightModal = () => { flightModal.style.display = 'block'; };
        window.closeFlightModal = () => { flightModal.style.display = 'none'; };

        const accModal = document.getElementById('accommodation-modal');
        window.openAccommodationModal = () => { accModal.style.display = 'block'; };
        window.closeAccommodationModal = () => { accModal.style.display = 'none'; };

        // é»æ“Šå¤–éƒ¨é—œé–‰ Modal
        window.onclick = function(e) {
            if (e.target == document.getElementById('edit-modal')) closeModal();
            if (e.target == accModal) closeAccommodationModal();
            if (e.target == flightModal) closeFlightModal();
            if (e.target == document.getElementById('delete-modal')) closeDeleteModal();
        }

        /* ---------------- è³‡æ–™è¨­å®š (è¡Œç¨‹/åœ°åœ–/è³¼ç‰©æ¸…å–® - ä¿æŒéœæ…‹) ---------------- */
        const spotsData = [
            // --- ç¾é£Ÿ (Food) ---
            { name: "Chateraise PREMIUM YATSUDOKI Shiodome", type: "food", note: "ç”œé»/è›‹ç³•", map: "https://goo.gl/maps/search/Chateraise+PREMIUM+YATSUDOKI+Shiodome" },
            { name: "å·è±Šæœ¬åº—", type: "food", note: "æˆç”°é°»é­šé£¯è€åº—", map: "https://goo.gl/maps/search/å·è±Šæœ¬åº—" },
            { name: "é¯›ã”ã¯ã‚“æ‡çŸ³ ç“”ç", type: "food", note: "ç®±æ ¹é¯›é­šé£¯ (å·²è¨‚ä½)", map: "https://goo.gl/maps/search/é¯›ã”ã¯ã‚“æ‡çŸ³+ç“”ç" },
            { name: "ã¾ãã‚ã¨ã‚·ãƒ£ãƒª æµ…è‰åº—", type: "food", note: "é®ªé­šä¸¼é£¯", map: "https://goo.gl/maps/search/ã¾ãã‚ã¨ã‚·ãƒ£ãƒª+æµ…è‰åº—" },
            { name: "TokyoSushiBowl", type: "food", note: "å£½å¸ä¸¼", map: "https://goo.gl/maps/search/TokyoSushiBowl" },
            { name: "Monmouth Tea", type: "food", note: "åƒé¦±è°·å¥¶èŒ¶å°ˆè³£", map: "https://goo.gl/maps/search/Monmouth+Tea" },
            { name: "Kenyan Shibuya (ã‚±ãƒ‹ãƒ¤ãƒ³)", type: "food", note: "æ¾€è°·è€ç‰Œç´…èŒ¶åº—", map: "https://goo.gl/maps/search/Kenyan+Shibuya" },
            { name: "Marlowe å¸ƒä¸", type: "food", note: "æ©«é ˆè³€ Port Market åº—", address: "6 Shinkocho, Yokosuka, Kanagawa 238-0005æ—¥æœ¬", map: "https://goo.gl/maps/search/Marlowe+Yokosuka" },
            { name: "Tsunami", type: "food", note: "æ©«é ˆè³€æµ·è»æ¼¢å ¡/å’–å“©", address: "æ—¥æœ¬ã€’238-0041 Kanagawa, Yokosuka, Honcho, 2 Chome-1-9 é£¯ç”°ãƒ“ãƒ«", map: "https://goo.gl/maps/search/Tsunami+Yokosuka" },
            { name: "HONEY BEE", type: "food", note: "æ©«é ˆè³€ç¾è»æ¼¢å ¡", address: "æ—¥æœ¬ã€’238-0041 Kanagawa, Yokosuka, Honcho, 2 Chome-ï¼‘ æœ¬ç”ºãƒ“ãƒ« 1F ãƒãƒ‹ãƒ¼ãƒ“", map: "https://goo.gl/maps/search/HONEY+BEE+Yokosuka" },
            { name: "Wood Island Curry", type: "food", note: "æ©«é ˆè³€å’–å“©", map: "https://goo.gl/maps/search/Wood+Island+Yokosuka" },
            { name: "ç‰›ãŸã‚“ è’ æ–°å®¿åº—", type: "food", note: "åšåˆ‡ç‰›èˆŒ", map: "https://goo.gl/maps/search/ç‰›ãŸã‚“+è’+æ–°å®¿" },
            { name: "å…¥é¹¿TOKYO å…­æœ¬æœ¨", type: "food", note: "ç±³å…¶æ—æ¨è–¦æ‹‰éºµ", map: "https://goo.gl/maps/search/å…¥é¹¿TOKYO+å…­æœ¬æœ¨" },
            { name: "Cafe La Boheme æ–°å®¿å¾¡è‹‘", type: "food", note: "ã€Šä½ çš„åå­—ã€‹å ´æ™¯é¤å»³", map: "https://goo.gl/maps/search/Cafe+La+Boheme+Shinjyuku+gyoen" },
            { name: "é‰„æ¿ç„¼ æµ…è‰ KUDAKA", type: "food", note: "éµæ¿ç‡’", map: "https://goo.gl/maps/search/é‰„æ¿ç„¼+æµ…è‰+KUDAKA" },
            { name: "ã†ã•ãã‚„CAFÃ‰", type: "food", note: "ä¸Šé‡éŠ…é‘¼ç‡’é¬†é¤…", map: "https://goo.gl/maps/search/ã†ã•ãã‚„CAFÃ‰" },
            { name: "CafÃ© Lapin", type: "food", note: "ä¸Šé‡å¾©å¤å’–å•¡å»³", map: "https://goo.gl/maps/search/CafÃ©+Lapin" },
            { name: "é­šå±‹ã‚„ã¾ã¡ã‚ƒã‚“", type: "food", note: "æµ·é®®å±…é…’å±‹", map: "https://goo.gl/maps/search/é­šå±‹ã‚„ã¾ã¡ã‚ƒã‚“" },
            { name: "æµ…è‰ç‰›å…‰", type: "food", note: "æ·ºè‰å’Œç‰›", map: "https://goo.gl/maps/search/æµ…è‰ç‰›å…‰" },
            { name: "é°»ç¦…", type: "food", note: "æ·ºè‰é°»é­šé£¯", map: "https://goo.gl/maps/search/é°»ç¦…" },
            { name: "æ°´å–œ Mizuki", type: "food", note: "æ·ºè‰åœŸé‹é£¯", address: "3 Chome-16-11 Nishiasakusa, Taito City, Tokyo 111-0035æ—¥æœ¬", map: "https://goo.gl/maps/search/æ°´å–œ+Mizuki" },
            { name: "å…«åå…«æµ…è‰", type: "food", note: "æŠ¹èŒ¶å°ˆè³£", map: "https://goo.gl/maps/search/å…«åå…«æµ…è‰" },
            { name: "å¾¡è“å­å¸ äº€å", type: "food", note: "æ·ºè‰éŠ…é‘¼ç‡’", map: "https://goo.gl/maps/search/å¾¡è“å­å¸+äº€å" },
            { name: "PATISSERIE TEN&", type: "food", note: "éŠ€åº§å¯éº—éœ²", map: "https://goo.gl/maps/search/PATISSERIE+TEN" },
            // --- è³¼ç‰© ---
            { name: "RINKAN è¥¿æ­¦æ–°å®¿ç«™åº—", type: "shopping", note: "äºŒæ‰‹ç²¾å“", map: "https://goo.gl/maps/search/RINKAN+è¥¿æ­¦æ–°å®¿", externalLink: "https://rinkan-online.com/products/10728-251019-0075" },
            { name: "å¤§æ¶Œè°·ãã‚ãŸã¾ã”é¤¨", type: "shopping", note: "é»‘è›‹ç´€å¿µå“", map: "https://goo.gl/maps/search/å¤§æ¶Œè°·ãã‚ãŸã¾ã”é¤¨" },
            { name: "CBD SHOP -YANAGI-", type: "shopping", note: "æ¾€è°·æœ¬åº— (CBNé¤…ä¹¾)", address: "æ—¥æœ¬ã€’150-0041 Tokyo, Shibuya, Jinnan, 1 Chome-12-16 1F è£å£", map: "https://goo.gl/maps/search/CBD+SHOP+YANAGI" },
            { name: "Vivienne Westwood Man", type: "shopping", note: "è¡¨åƒé“åº—", map: "https://goo.gl/maps/search/Vivienne+Westwood+Man+Omotesando" },
            { name: "Vivienne Westwood Red Label", type: "shopping", note: "åŸå®¿/è¡¨åƒé“", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 1 Chome-11-6 ãƒ©ãƒ•ã‚©ãƒ¼ãƒ¬åŸå®¿1F", map: "https://goo.gl/maps/search/Vivienne+Westwood+Red+Label" },
            { name: "Closet Child", type: "shopping", note: "Vivienne äºŒæ‰‹", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 1 Chome-7-6 Coxy176 ãƒ“ãƒ« 101", map: "https://goo.gl/maps/search/Closet+Child+Vivienne" },
            { name: "BEAMS åŸå®¿ Annex", type: "shopping", note: "æ½®æµæœé£¾", map: "https://goo.gl/maps/search/BEAMS+Harajuku+Annex" },
            { name: "GR8", type: "shopping", note: "åŸå®¿ Laforet ç²¾é¸åº—", map: "https://goo.gl/maps/search/GR8+Harajuku" },
            { name: "BEAMS JAPAN", type: "shopping", note: "æ–°å®¿æ—¥æœ¬é¸ç‰©", address: "æ—¥æœ¬ã€’160-0022 Tokyo, Shinjuku City, Shinjuku, 3 Chome-32-6 B1F 5F", map: "https://goo.gl/maps/search/BEAMS+JAPAN" },
            { name: "KITH TOKYO", type: "shopping", note: "æ¾€è°·å®®ä¸‹å…¬åœ’", map: "https://goo.gl/maps/search/KITH+TOKYO" },
            { name: "ä¼Šå‹¢ä¸¹ãƒ¡ãƒ³ã‚ºé¤¨", type: "shopping", note: "æ–°å®¿ç”·å£«é¤¨", map: "https://goo.gl/maps/search/Isetan+Men's" },
            { name: "HUMAN MADE åŸå®¿", type: "shopping", note: "æ½®æµå“ç‰Œ", map: "https://goo.gl/maps/search/HUMAN+MADE+Harajuku" },
            { name: "HUMAN MADE OFFLINE STORE", type: "shopping", note: "ä¸­ç›®é»‘/å¤–è‹‘å‰", map: "https://goo.gl/maps/search/HUMAN+MADE+OFFLINE+STORE" },
            { name: "éŠ€åº§ã‚«ãƒ¬ãƒ³ (Karen)", type: "shopping", note: "è¡Œæç®± (æ·ºè‰/æ—¥æœ¬æ©‹)", map: "https://goo.gl/maps/search/Ginza+Karen" },
            { name: "è‡ªå®¶è£½ä¸ƒå‘³ æ¾å®®", type: "shopping", note: "å·¢é´¨ä¸ƒå‘³ç²‰", map: "https://goo.gl/maps/search/Sugamo+Matsumiya" },
            { name: "Acro Tokyo", type: "shopping", note: "åŸå®¿ Laforet", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 1 Chome-11-6 ãƒ©ãƒ•ã‚©ãƒ¼ãƒ¬åŸå®¿ B1F", map: "https://goo.gl/maps/search/Acro+Tokyo+Laforet" },
            { name: "Nepenthes Tokyo", type: "shopping", note: "Needles æœ¬åº—", map: "https://goo.gl/maps/search/Nepenthes+Tokyo" },
            { name: "RINKAN æ¾€è°·åº—", type: "shopping", note: "æ½®æµäºŒæ‰‹", address: "æ—¥æœ¬ã€’150-0041 Tokyo, Shibuya, Jinnan, 1 Chome-12-16 å’Œå…‰ ãƒ“ãƒ« 1Fï½¥2F", map: "https://goo.gl/maps/search/RINKAN+Shibuya", externalLink: "https://rinkan-online.com/products/10211-250729-0079" },
            { name: "STUDIOUS", type: "shopping", note: "åŸå®¿/æ¾€è°·", address: "æ—¥æœ¬ã€’150-0001 Tokyo, Shibuya, Jingumae, 4 Chome-26-32 1F", map: "https://goo.gl/maps/search/STUDIOUS+Tokyo" },
            { name: "STUDIOUS TOKYO è¡¨å‚é“", type: "shopping", note: "åŸå®¿æœ¬åº—", map: "https://goo.gl/maps/search/STUDIOUS+TOKYO+Omotesando" },
            // --- æ™¯é» ---
            { name: "æ·ºè‰èŠ±ç­", type: "sightseeing", note: "å’Œæœç§Ÿå€Ÿ", map: "https://goo.gl/maps/search/Asakusa+Hanaikada" },
            { name: "é ˆè³€ç¥ç¤¾ ç”·æ®µ", type: "sightseeing", note: "ã€Šä½ çš„åå­—ã€‹éšæ¢¯", map: "https://goo.gl/maps/search/Suga+Shrine+Stairs" },
            { name: "è–æ©‹ (Hijiri Bridge)", type: "sightseeing", note: "ã€Šéˆ´èŠ½ä¹‹æ—…ã€‹å ´æ™¯", map: "https://goo.gl/maps/search/Hijiri+Bridge" },
            { name: "å¹³å’Œã®é³¥å±…", type: "sightseeing", note: "ç®±æ ¹ç¥ç¤¾æ°´ä¸­é³¥å±…", map: "https://goo.gl/maps/search/Heiwa+no+Torii" },
            { name: "è˜†ä¹‹æ¹–", type: "sightseeing", note: "ç®±æ ¹æµ·è³Šèˆ¹", map: "https://goo.gl/maps/search/Lake+Ashi" },
            { name: "æ­Œèˆä¼ç”ºä¸€ç•ªè¡—", type: "sightseeing", note: "æ–°å®¿åœ°æ¨™", map: "https://goo.gl/maps/search/Kabukicho+Ichibangai" },
            { name: "YOKOSUKA è»æ¸¯å·¡èˆª", type: "sightseeing", note: "æ©«é ˆè³€éŠèˆ¹", map: "https://goo.gl/maps/search/Yokosuka+Naval+Port+Cruise" },
            { name: "å¤–è‹‘éŠ€æä¸¦æœ¨", type: "sightseeing", note: "æ˜æ²»ç¥å®®å¤–è‹‘", map: "https://goo.gl/maps/search/Meiji+Jingu+Gaiem+Ginkgo+Avenue" },
            { name: "å¾…ä¹³å±± æœ¬é¾é™¢", type: "sightseeing", note: "æ·ºè‰èƒ½é‡æ™¯é»", map: "https://goo.gl/maps/search/Matsuchiyama+Shoden" },
            { name: "ä¸‹åŒ—æ²¢ SHELTER", type: "sightseeing", note: "ã€Šå­¤ç¨æ–æ»¾ã€‹Live House", map: "https://goo.gl/maps/search/Shimokitazawa+SHELTER" },
            { name: "æ¾€è°·å…¨å‘åå­—è·¯å£", type: "sightseeing", note: "Shibuya Crossing", map: "https://goo.gl/maps/search/Shibuya+Crossing" },
            { name: "åƒèº°å­è‚²åœ°è”µè©è–©", type: "sightseeing", note: "å¢ä¸Šå¯º", map: "https://goo.gl/maps/search/Zojoji+Jizo" },
            { name: "è¿è³“é¤¨èµ¤å‚é›¢å®®", type: "sightseeing", note: "è¥¿æ´‹å®®æ®¿", map: "https://goo.gl/maps/search/Akasaka+Palace" },
            { name: "çš‡å±…", type: "sightseeing", note: "äºŒé‡æ©‹", map: "https://goo.gl/maps/search/Imperial+Palace+Tokyo" },
            { name: "æˆç”°å±±æ–°å‹å¯º", type: "sightseeing", note: "æˆç”°æ©Ÿå ´é™„è¿‘", map: "https://goo.gl/maps/search/Naritasan+Shinshoji" },
            { name: "SHIBUYA SKY", type: "sightseeing", note: "æ¾€è°·é«˜ç©ºå±•æœ›å°", map: "https://goo.gl/maps/search/SHIBUYA+SKY" },
            { name: "æ˜æ²»ç¥å®®", type: "sightseeing", note: "åŸå®¿", map: "https://goo.gl/maps/search/Meiji+Jingu" },
            { name: "KALEDOTOWER (å¾…ç¢ºèª)", type: "sightseeing", note: "åœ°é»éœ€ç¢ºèª", map: "https://www.google.com/maps" } 
        ];

        const shoppingList = [
            // è—¥å¦ä¿é¤Š
            { category: "è—¥å¦ä¿é¤Š", name: "ã€plus eauã€‘ç€æµ·é€ å‹é­”æ³•æ£’", location: "Loft/Plaza/æ¾æœ¬æ¸…", tag: "Drugstore" },
            { category: "è—¥å¦ä¿é¤Š", name: "EVEæ­¢ç—›è—¥", location: "å„è—¥å¦åº—", tag: "Drugstore" },
            { category: "è—¥å¦ä¿é¤Š", name: "Kiss meã€Œç«æ¯›å®šå‹æ¶²ã€", location: "å„è—¥å¦åº—/Donki", tag: "Drugstore" },
            { category: "è—¥å¦ä¿é¤Š", name: "Melté«ªåŒ–ç²§æ°´", location: "Loft/Plaza", tag: "Drugstore" },
            { category: "è—¥å¦ä¿é¤Š", name: "UHAå‘³è¦ºç³–è£œéµç‡Ÿé¤Šè»Ÿç³–", location: "å„è—¥å¦åº—/è¶…å•†", tag: "Drugstore" },
            { category: "è—¥å¦ä¿é¤Š", name: "Cp-Lip å”‡éƒ¨ç²¾è¯æ¶²", location: "å„è—¥å¦åº—", tag: "Drugstore" },
            { category: "è—¥å¦ä¿é¤Š", name: "SOFINA iP ç²¾è¯ä¹³éœœ", location: "æ¾æœ¬æ¸…/å°ˆæ«ƒ", tag: "Drugstore" },
            // ç¾ç³éš±çœ¼
            { category: "ç¾ç³éš±çœ¼", name: "éš±çœ¼ (BARRIEYES)", location: "Donki/BicContact", tag: "Contact" },
            { category: "ç¾ç³éš±çœ¼", name: "éš±çœ¼ (GAL NEVER DIE)", location: "Donki", tag: "Contact" },
            { category: "ç¾ç³éš±çœ¼", name: "éš±çœ¼ (NS COLLECTION)", location: "Donki", tag: "Contact" },
            // ç”Ÿæ´»é›œè²¨
            { category: "ç”Ÿæ´»é›œè²¨/é›»å™¨", name: "3coinså¾®æ³¢çˆçƒ¤ç›¤", location: "3COINS", tag: "Variety" },
            { category: "ç”Ÿæ´»é›œè²¨/é›»å™¨", name: "recolteèª¿ç†æ©Ÿ", location: "Bic/Yodobashi", tag: "Variety" },
            // æœé£¾é…ä»¶
            { category: "æœé£¾é…ä»¶", name: "é´ä¸‹å±‹çš„ä¿æš–è¤²è¥ª", location: "Tabio/é´ä¸‹å±‹", tag: "Fashion" }
        ];

        const itineraryDetails = {
            day1: [
                { time: "06:35", title: "æŠµé”æˆç”°æ©Ÿå ´ T3", desc: "å…¥å¢ƒã€‚", recommended: false },
                { time: "08:13", title: "N'EX æˆç”°ç‰¹å¿«", desc: "å¾€æ–°å®¿ (09:47 æŠµ)ã€‚", recommended: false },
                { time: "10:00", title: "å°ç”°æ€¥æµªæ¼«ç‰¹å¿«", desc: "å¾€ç®±æ ¹æ¹¯æœ¬ (11:27 æŠµ)ã€‚", recommended: false },
                { 
                    time: "12:15", 
                    title: "åˆé¤ï¼šé¯›ã”ã¯ã‚“æ‡çŸ³ ç“”ç", 
                    desc: "â˜… å·²è¨‚ä½ 12:15ã€‚", 
                    recommended: false,
                    diningOptions: [
                        { name: "ã¯ã¤èŠ±ãã° æœ¬åº—", note: "è‡ªç„¶è–¯è•éº¥éºµ", rating: "3.58", mapUrl: "https://goo.gl/maps/search/Hatsuhana+Soba+Hakone", inMap: false },
                        { name: "æ¹¯è‘‰ä¸¼ ç›´å‰", note: "æ¹¯è‘‰ä¸¼", rating: "3.49", mapUrl: "https://goo.gl/maps/search/Yubadon+Naokichi", inMap: false }
                    ]
                },
                { time: "13:00", title: "ç®±æ ¹ç¶“å…¸ç’°éŠ", desc: "ç™»å±±é›»è»Š/çºœè»Š/å¤§æ¹§è°·ã€‚", recommended: false },
                { time: "15:50", title: "ç®±æ ¹æµ·è³Šèˆ¹", desc: "æ¡ƒæºå°â†’å…ƒç®±æ ¹æ¸¯ã€‚æ‹é³¥å±…ã€‚", recommended: false },
                { 
                    time: "18:00", 
                    title: "æ™šé¤ï¼šç®±æ ¹ç•¶åœ°æ–™ç†", 
                    desc: "è»Šç«™é™„è¿‘æˆ–é£¯åº—è‡ªåŠ©é¤ã€‚", 
                    recommended: false,
                    diningOptions: [
                         { name: "çŸ¥å®¢èŒ¶å®¶", note: "è±†è…/å±±è—¥", rating: "3.51", mapUrl: "https://goo.gl/maps/search/Shikajaya+Hakone", inMap: false },
                         { name: "å–œä¹‹åŠ©", note: "é®®é­šå±…é…’å±‹", rating: "3.49", mapUrl: "https://goo.gl/maps/search/Kinosuke+Hakone", inMap: false }
                    ]
                },
                { time: "20:00", title: "æº«æ³‰ & ä¼‘æ¯", desc: "å…¥ä½ Hakone Pax Yoshinoã€‚", recommended: false }
            ],
            day2: [
                { 
                    time: "09:30", 
                    title: "å‰å¾€æ©«é ˆè³€", 
                    desc: "JR (11:04 æŠµ)ã€‚<br><a href='https://world.jorudan.co.jp/mln/zh-tw/?p=50&from=%e7%ae%b1%e6%a0%b9%e6%b9%af%e6%9c%ac&to=%e6%a9%ab%e9%a0%88%e8%b3%80&date=2025%2f12%2f06&time=09%3a35&ft=0&ic=0&ut=0&up=0&us=0&nzm=0&sub_lang=ja&route=1' target='_blank' class='text-blue-500 hover:underline font-bold mt-1 inline-block'>ğŸ”— æŸ¥çœ‹ä¹˜è»Šè·¯ç·š (Jorudan)</a>", 
                    recommended: false 
                },
                { time: "12:00", title: "è»æ¸¯å·¡èˆª", desc: "â˜… é ç´„ 12:00 èˆ¹ç­ã€‚", recommended: false },
                { 
                    time: "13:00", 
                    title: "åˆé¤ï¼šHONEY BEE", 
                    desc: "ç¾è»æ¼¢å ¡ã€‚", 
                    recommended: false,
                    diningOptions: [
                        { name: "Tsunami", note: "æµ·è»å’–å“©/æ¼¢å ¡", rating: "3.49", mapUrl: "https://goo.gl/maps/search/Tsunami+Yokosuka", inMap: true },
                        { name: "Wood Island Curry", note: "æ©«é ˆè³€å’–å“©", rating: "3.48", mapUrl: "https://goo.gl/maps/search/Wood+Island+Yokosuka", inMap: true }
                    ]
                },
                { 
                    time: "15:45", 
                    title: "å‰å¾€æ±äº¬æ°‘å®¿", 
                    desc: "ç§‹è‘‰åŸ/æœ«å»£ç”ºã€‚17:30 Check-inã€‚<br><a href='https://world.jorudan.co.jp/mln/zh-tw/?p=50&from=%e6%a9%ab%e9%a0%88%e8%b3%80&to=%e7%a7%8b%e8%91%89%e5%8e%9f&date=2025%2f12%2f06&time=15%3a00&ft=0&ic=0&ut=0&up=0&us=0&nzm=0&sub_lang=ja&route=6' target='_blank' class='text-blue-500 hover:underline font-bold mt-1 inline-block'>ğŸ”— æŸ¥çœ‹ä¹˜è»Šè·¯ç·š (Jorudan)</a>", 
                    recommended: false 
                },
                { 
                    time: "18:30", 
                    title: "æ™šé¤ï¼šå…¥é¹¿TOKYO", 
                    desc: "å…­æœ¬æœ¨æ‹‰éºµã€‚", 
                    recommended: false,
                    diningOptions: [
                        { name: "è±šçµ„é£Ÿå ‚", note: "ç‚¸è±¬æ’", rating: "3.78", mapUrl: "https://goo.gl/maps/search/Butagumi+Shokudo", inMap: false },
                        { name: "éŠ€åº§ ç¯", note: "é›ç™½æ¹¯æ‹‰éºµ", rating: "3.58", mapUrl: "https://goo.gl/maps/search/Ginza+Kagari+Roppongi", inMap: false }
                    ]
                },
                { time: "20:30", title: "è³¼ç‰©ï¼šGinza Karen", desc: "äººå½¢ç”ºè²·è¡Œæç®±ã€‚", recommended: false }
            ],
            day3: [
                { time: "09:00", title: "çš‡å±… (äºŒé‡æ©‹)", desc: "äºŒé‡æ©‹å‰ç«™ã€‚", recommended: false },
                { time: "10:30", title: "èµ¤å‚é›¢å®®", desc: "åƒè§€æœ¬é¤¨/åº­åœ’ã€‚", recommended: false },
                { 
                    time: "12:30", 
                    title: "åˆé¤ & éŠ€æä¸¦æœ¨", 
                    desc: "æ˜æ²»ç¥å®®å¤–è‹‘éŠ€æç¥­ã€‚", 
                    recommended: true, 
                    recText: "æ¨è–¦ï¼šShake Shack",
                    diningOptions: [
                        { name: "Cafe La Boheme", note: "ã€Šä½ çš„åå­—ã€‹é¤å»³", rating: "3.45", mapUrl: "https://goo.gl/maps/search/Cafe+La+Boheme+Shinjyuku+gyoen", inMap: true },
                        { name: "ã¾ã„æ³‰ é’å±±", note: "ç‚¸è±¬æ’", rating: "3.58", mapUrl: "https://goo.gl/maps/search/Tonkatsu+Maisen+Aoyama", inMap: false }
                    ]
                },
                { time: "14:30", title: "åŸå®¿ / è¡¨åƒé“", desc: "KITH, BEAMS, Human Madeã€‚", recommended: false },
                { time: "16:00", title: "SHIBUYA SKY", desc: "â˜… é ç´„ 16:00 æ—¥è½ã€‚", recommended: false },
                { time: "18:00", title: "æ¾€è°· PARCO/Donki", desc: "ä»»å¤©å ‚, è—¥å¦ã€‚", recommended: false },
                { 
                    time: "19:30", 
                    title: "æ™šé¤ï¼šç‰›ãŸã‚“ è’", 
                    desc: "åšåˆ‡ç‰›èˆŒã€‚", 
                    recommended: false,
                    diningOptions: [
                        { name: "Kenyan Shibuya", note: "ç´…èŒ¶/è¼•é£Ÿ", rating: "3.55", mapUrl: "https://goo.gl/maps/search/Kenyan+Shibuya", inMap: true },
                        { name: "ã‹ã¤ã©ã‚“å±‹ ç‘å…†", note: "è±¬æ’ä¸¼", rating: "3.68", mapUrl: "https://goo.gl/maps/search/Katsudon-ya+Zuicho", inMap: false }
                    ]
                }
            ],
            day4: [
                { time: "09:00", title: "æ·ºè‰å’Œæœ", desc: "æ·ºè‰èŠ±ç­ã€‚", recommended: false },
                { time: "10:30", title: "æ·ºè‰å¯º / é›·é–€", desc: "æ‹ç…§ã€é€›è¡—ã€‚", recommended: false },
                { 
                    time: "12:30", 
                    title: "åˆé¤ï¼šæ·ºè‰ç¾é£Ÿ", 
                    desc: "å’Œç‰› / åœŸé‹é£¯ / å£½å¸ã€‚", 
                    recommended: false,
                    diningOptions: [
                        { name: "é°»ç¦…", note: "é°»é­šé£¯", rating: "3.80", mapUrl: "https://goo.gl/maps/search/Unazen+Asakusa", inMap: true },
                        { name: "æ°´å–œ Mizuki", note: "åœŸé‹é£¯", rating: "3.45", mapUrl: "https://goo.gl/maps/search/Mizuki+Asakusa", inMap: true }
                    ]
                },
                { time: "14:30", title: "æ°´ä¸Šå·´å£«", desc: "â˜… é ç´„ï¼šæ·ºè‰ â†’ æµœé›¢å®®ã€‚", recommended: false },
                { time: "15:30", title: "æ±äº¬éµå¡”", desc: "èŠå…¬åœ’/èµ¤ç¾½æ©‹æ‹ç…§ã€‚", recommended: false },
                { 
                    time: "17:30", 
                    title: "éŠ€åº§é€›è¡— & æ™šé¤", 
                    desc: "è²·å¯éº—éœ²ï¼Œåƒæ™šé¤ã€‚", 
                    recommended: true, 
                    recText: "æ¨è–¦ï¼šPATISSERIE TEN&",
                    diningOptions: [
                        { name: "éŠ€åº§ ç¯ æœ¬åº—", note: "é›ç™½æ¹¯", rating: "3.78", mapUrl: "https://goo.gl/maps/search/Ginza+Kagari", inMap: false },
                        { name: "èŠ±å±±ã†ã©ã‚“", note: "å¯¬çƒé¾éºµ", rating: "3.60", mapUrl: "https://goo.gl/maps/search/Hanayama+Udon+Ginza", inMap: false }
                    ]
                }
            ],
            day5: [
                { time: "09:30", title: "é€€æˆ¿", desc: "å¾€æ±äº¬ç«™ã€‚", recommended: false },
                { time: "10:00", title: "æ±äº¬è»Šç«™ä¸€ç•ªè¡—", desc: "å‹•æ¼«è¡—ã€ä¼´æ‰‹ç¦®ã€‚", recommended: false },
                { 
                    time: "12:30", 
                    title: "åˆé¤ï¼šæ‹‰éºµè¡—/KITTE", 
                    desc: "æ‹‰éºµæˆ–å£½å¸ã€‚", 
                    recommended: false,
                    diningOptions: [
                        { name: "å…­å˜èˆ", note: "æ²¾éºµ", rating: "3.77", mapUrl: "https://goo.gl/maps/search/Rokurinsha+Tokyo+Station", inMap: false },
                        { name: "ã¤ã˜åŠ", note: "æµ·é®®ç å¯¶ç›’", rating: "3.75", mapUrl: "https://goo.gl/maps/search/Tsujihan+Nihonbashi", inMap: false }
                    ]
                },
                { time: "14:00", title: "å‰å¾€æ©Ÿå ´ T1", desc: "N'EX (15:10 æŠµ)ã€‚è¨—é‹ã€‚", recommended: false },
                { time: "15:40", title: "æŠ˜è¿”æˆç”°ç«™", desc: "å·è±Šæœ¬åº—æŠ½è™Ÿç¢¼ç‰Œåƒé°»é­šã€‚", recommended: true, recText: "æ¨è–¦ï¼šå·è±Š æœ¬åº—" },
                { time: "17:30", title: "è¿”å›æ©Ÿå ´ T1", desc: "äº¬æˆæˆç”° â†’ T1ã€‚", recommended: false },
                { time: "17:45", title: "å…ç¨…åº—", desc: "æœ€å¾Œæ¡è²·ã€‚", recommended: false },
                { time: "19:55", title: "èµ·é£›", desc: "TR875ã€‚", recommended: false }
            ]
        };

        // é é¢åˆ‡æ›
        const navBtns = document.querySelectorAll('.nav-btn');
        const sections = document.querySelectorAll('.content-section');

        // Scroll helper function
        function scrollToNavBtn(btn) {
            const container = document.getElementById('navbar-scroll-container');
            const btnRect = btn.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            // å¦‚æœæŒ‰éˆ•åœ¨è¦–çª—å¤–æˆ–é‚Šç·£ï¼Œæ»¾å‹•
            const scrollLeft = btn.offsetLeft - (container.offsetWidth / 2) + (btn.offsetWidth / 2);
            container.scrollTo({ left: scrollLeft, behavior: 'smooth' });
        }

        // Swipe Functionality Variables
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;
        const mainContent = document.getElementById('main-content');
        
        // Navigation Handler
        function switchTab(index) {
            if (index < 0 || index >= navBtns.length) return;
            const targetBtn = navBtns[index];
            
            navBtns.forEach(b => b.classList.remove('active'));
            sections.forEach(s => s.classList.remove('active'));
            
            targetBtn.classList.add('active');
            document.getElementById(targetBtn.dataset.section).classList.add('active');
            scrollToNavBtn(targetBtn);
        }

        navBtns.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                switchTab(index);
            });
        });

        // Swipe Listeners
        mainContent.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: true});

        mainContent.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, {passive: true});

        function handleSwipe() {
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;
            
            // Thresholds
            const minSwipeDistance = 50;
            const maxVerticalDistance = 100; // é˜²æ­¢å‚ç›´æ»¾å‹•èª¤è§¸

            // Check if horizontal swipe and not vertical scroll
            if (Math.abs(diffX) > minSwipeDistance && Math.abs(diffY) < maxVerticalDistance) {
                // Find current active index
                let currentIndex = -1;
                navBtns.forEach((btn, index) => {
                    if (btn.classList.contains('active')) currentIndex = index;
                });

                // Swipe Right (Previous)
                if (diffX > 0 && currentIndex > 0) {
                    switchTab(currentIndex - 1);
                }
                // Swipe Left (Next)
                else if (diffX < 0 && currentIndex < navBtns.length - 1) {
                    switchTab(currentIndex + 1);
                }
            }
        }

        // è¡Œç¨‹æ¸²æŸ“
        function renderItinerary(dayId, btnElement) {
            if(btnElement) {
                document.querySelectorAll('.date-tab').forEach(t => t.classList.remove('active'));
                btnElement.classList.add('active');
            }

            const container = document.getElementById('itinerary-content');
            const details = itineraryDetails[dayId];
            
            let html = `<div class="timeline-container">`;
            
            let dayTitle = "";
            if(dayId === 'day1') dayTitle = "12/5 (äº”) ç®±æ ¹æº«æ³‰ä¹‹æ—…";
            if(dayId === 'day2') dayTitle = "12/6 (å…­) æ©«é ˆè³€ & å…­æœ¬æœ¨";
            if(dayId === 'day3') dayTitle = "12/7 (æ—¥) éŠ€æ & æ¾€è°·";
            if(dayId === 'day4') dayTitle = "12/8 (ä¸€) æ·ºè‰ & éŠ€åº§";
            if(dayId === 'day5') dayTitle = "12/9 (äºŒ) æ±äº¬è»Šç«™ & è¿”ç¨‹";

            html += `<h3 class="text-lg md:text-xl font-bold text-jp-gold mb-4 border-b border-jp-gold/30 pb-2">${dayTitle}</h3>`;

            details.forEach(item => {
                let recBadge = item.recommended ? `<div class="recommend-tag">âœ¨ ${item.recText || "æ¨è–¦"}</div>` : '';
                
                let diningHtml = '';
                if (item.diningOptions && item.diningOptions.length > 0) {
                    diningHtml += `
                        <div class="dining-list">
                            <div class="dining-header">ğŸ½ï¸ æ¨è–¦</div>
                    `;
                    item.diningOptions.forEach(opt => {
                        let mapBadge = opt.inMap ? `<span class="in-map-badge">åœ°åœ–</span>` : '';
                        let linkIcon = opt.externalLink ? `<a href="${opt.externalLink}" target="_blank" class="text-blue-500 hover:text-blue-700 ml-1">ğŸ”—</a>` : '';
                        
                        diningHtml += `
                            <div class="dining-item">
                                <div class="flex-grow">
                                    <span class="dining-name-link">
                                        <a href="${opt.mapUrl}" target="_blank" class="hover:text-jp-gold hover:underline flex items-center text-jp-brown">
                                            ${opt.name}
                                        </a>
                                        ${mapBadge}
                                        ${linkIcon}
                                    </span>
                                    <span class="dining-note">${opt.note}</span>
                                </div>
                                <span class="dining-rating">â˜…${opt.rating}</span>
                            </div>
                        `;
                    });
                    diningHtml += `</div>`;
                }

                html += `
                    <div class="detail-item">
                        <div class="detail-time">${item.time}</div>
                        <div class="detail-title">${item.title}</div>
                        <div class="detail-desc">
                            ${item.desc}
                            ${recBadge}
                            ${diningHtml}
                        </div>
                    </div>
                `;
            });
            html += `</div>`;
            container.innerHTML = html;
        }

        // åœ°åœ–ç›¸é—œ
        const spotsListContainer = document.getElementById('spots-list-container');
        const mapFrame = document.getElementById('map-frame');
        const mapPlaceholder = document.getElementById('map-placeholder');
        const filterBtns = document.querySelectorAll('.filter-btn');

        function updateMap(spotName) {
            const spot = spotsData.find(s => s.name === spotName);
            let query = spotName + " æ—¥æœ¬"; 
            if (spot && spot.address) query = spot.address;
            mapFrame.src = `https://maps.google.com/maps?q=${encodeURIComponent(query)}&output=embed`;
            mapPlaceholder.style.display = 'none';
            document.querySelectorAll('.spot-item').forEach(el => {
                el.classList.remove('active-spot');
                if (el.dataset.name === spotName) el.classList.add('active-spot');
            });
        }

        function renderSpotsList(filter = 'all') {
            spotsListContainer.innerHTML = '';
            const filtered = filter === 'all' ? spotsData : spotsData.filter(s => s.type === filter);
            
            filtered.forEach(spot => {
                let badgeColor = '';
                let typeLabel = '';
                switch(spot.type) {
                    case 'food': badgeColor = 'bg-jp-red text-white'; typeLabel = 'ç¾é£Ÿ'; break;
                    case 'shopping': badgeColor = 'bg-jp-gold text-white'; typeLabel = 'è³¼ç‰©'; break;
                    case 'sightseeing': badgeColor = 'bg-jp-brown text-white'; typeLabel = 'æ™¯é»'; break;
                }
                const card = document.createElement('div');
                card.className = "bg-white p-2 rounded border border-gray-200 spot-item";
                card.dataset.name = spot.name;
                card.onclick = (e) => { if(e.target.tagName !== 'A') updateMap(spot.name); };
                
                let linkHtml = spot.externalLink ? `<a href="${spot.externalLink}" target="_blank" class="text-blue-500 hover:text-blue-700 ml-1">ğŸ”—</a>` : '';

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <h4 class="font-bold text-jp-brown text-sm flex items-center">
                            ${spot.name}
                            ${linkHtml}
                        </h4>
                        <span class="text-xs px-1.5 py-0.5 rounded ${badgeColor} whitespace-nowrap ml-2">${typeLabel}</span>
                    </div>
                    <p class="text-xs text-gray-600">${spot.note}</p>
                `;
                spotsListContainer.appendChild(card);
            });
        }

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active', 'bg-jp-brown', 'text-white'));
                btn.classList.add('active', 'bg-jp-brown', 'text-white');
                renderSpotsList(btn.dataset.filter);
            });
        });

        // è³¼ç‰©æ¸…å–®
        const shoppingContainer = document.getElementById('shopping-list-container');
        function renderShoppingList() {
            const categories = {};
            shoppingList.forEach(item => {
                if(!categories[item.category]) categories[item.category] = [];
                categories[item.category].push(item);
            });
            let html = '';
            for (const [catName, items] of Object.entries(categories)) {
                html += `<div><h3 class="shop-category">${catName}</h3><div class="space-y-1">`;
                items.forEach((item, index) => {
                    let tagClass = '';
                    if(item.tag === 'Drugstore') tagClass = 'tag-drugstore';
                    if(item.tag === 'Variety') tagClass = 'tag-variety';
                    if(item.tag === 'Fashion') tagClass = 'tag-fashion';
                    if(item.tag === 'Contact') tagClass = 'tag-contact';
                    const uid = `shop-${catName}-${index}`;
                    html += `
                        <div class="shop-item" onclick="toggleShopItem(this)">
                            <input type="checkbox" class="mt-1 mr-2 cursor-pointer" id="${uid}">
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <span class="font-bold text-jp-brown text-xs shop-name">${item.name}</span>
                                    <span class="shop-tag ${tagClass}">${item.tag}</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">ğŸ“ ${item.location}</div>
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }
            shoppingContainer.innerHTML = html;
        }

        window.toggleShopItem = (el) => {
            const checkbox = el.querySelector('input[type="checkbox"]');
            if(event.target !== checkbox) checkbox.checked = !checkbox.checked;
            el.classList.toggle('checked', checkbox.checked);
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderSpotsList('all');
            renderShoppingList();
            renderItinerary('day1', document.querySelector('.date-tab'));
            updateMap('Tokyo Station');
        });
    </script>
</body>
</html>